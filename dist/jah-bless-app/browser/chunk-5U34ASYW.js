import{$ as yo,Aa as it,B as ot,Ca as Er,Ea as Fe,Fa as Y,Ga as N,Ha as Pt,I as Ct,Ia as Le,J as Mt,Ja as So,Ka as _e,Ma as Ft,N as ue,Na as Do,O as po,Oa as Lt,P as ho,Pa as Ro,Qa as No,R as nt,T as It,U as De,X as go,Z as q,_ as vo,aa as ce,ba as re,da as xo,e as lo,ea as je,f as mo,fa as We,ga as wo,ha as $o,ia as P,ja as _,ka as _r,la as qe,ma as kt,n as ae,na as _o,p as Ve,ra as ge,sa as Eo,ta as At,ua as st,v as fo,va as bo,w as K,xa as Oo,ya as Pe,za as Tt}from"./chunk-PHKG3IGQ.js";import{a as M,b as L,f as $}from"./chunk-YJ5HMLQM.js";var Bt;function Ks(){if(Bt)return Bt;if(typeof crypto>"u"||typeof crypto.subtle>"u"||typeof crypto.subtle.digest!="function")throw _("UT8",{args:{typeof_crypto:typeof crypto,typeof_crypto_subtle:typeof crypto?.subtle,typeof_crypto_subtle_digest:typeof crypto?.subtle?.digest}});return Bt=crypto.subtle.digest.bind(crypto.subtle),Bt}function Qs(e){return $(this,null,function*(){var t=new TextEncoder().encode(e),o=yield Ks()("SHA-256",t),r=Array.prototype.map.call(new Uint8Array(o),n=>("00"+n.toString(16)).slice(-2)).join("");return r})}var Ut=Qs;function Ha(e){for(var t=0,o=e.length,r=0;r<o;r++)t=t+e.charCodeAt(r),t|=0;return t}function ze(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var o,r;if(Array.isArray(e)){if(o=e.length,o!==t.length)return!1;for(r=o;r--!==0;)if(!ze(e[r],t[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();var n=Object.keys(e);if(o=n.length,o!==Object.keys(t).length)return!1;for(r=o;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,n[r]))return!1;for(r=o;r--!==0;){var s=n[r];if(!ze(e[s],t[s]))return!1}return!0}return e!==e&&t!==t}var br="16.20.0";var Vt={};var Ys="6da4936d1425ff3a5c44c02342c6daf791d266be3ae8479b8ec59e261df41b93",Sr=16,Or=ge,Co=!1;function Mo(){return $(this,null,function*(){return Co||(Co=!0,Or=$(null,null,function*(){return!!(Vt.premium&&typeof Vt.premium=="string"&&(yield Ut(Vt.premium))===Ys)})),Or})}function Be(e){for(var t="",o=0;o<e.length;o++){var r=e[o];if(r==="-")return parseInt(t,10);t+=r}throw new Error("malformatted revision: "+e)}function at(e,t){var o=t?Be(t._rev)+1:1;return o+"-"+e}function I(e){var t=e.split("-"),o="RxDB";return t.forEach(r=>{o+=Tt(r)}),o+="Plugin",new Error(`You are using a function which must be overwritten by a plugin.
        You should either prevent the usage of this function or add the plugin via:
            import { `+o+" } from 'rxdb/plugins/"+e+`';
            addRxPlugin(`+o+`);
        `)}function su(e){var t={name:e.name,message:e.message,rxdb:e.rxdb,parameters:e.parameters,extensions:e.extensions,code:e.code,url:e.url,stack:e.stack?e.stack.replace(/\n/g,` 
 `):void 0};return t}var Dr=0;function he(){var e=Date.now();e=e+.01,e<=Dr&&(e=Dr+.01);var t=parseFloat(e.toFixed(2));return Dr=t,t}var Rr={preAddRxPlugin:[],preCreateRxDatabase:[],createRxDatabase:[],preCreateRxCollection:[],createRxCollection:[],createRxState:[],postCloseRxCollection:[],postRemoveRxCollection:[],preCreateRxSchema:[],createRxSchema:[],prePrepareRxQuery:[],preCreateRxQuery:[],prePrepareQuery:[],createRxDocument:[],postCreateRxDocument:[],preCreateRxStorageInstance:[],preStorageWrite:[],preMigrateDocument:[],postMigrateDocument:[],preCloseRxDatabase:[],postRemoveRxDatabase:[],postCleanup:[],preReplicationMasterWrite:[],preReplicationMasterWriteDocumentsHandle:[]};function V(e,t){Rr[e].length>0&&Rr[e].forEach(o=>o(t))}function Re(e,t){return $(this,null,function*(){for(var o of Rr[e])yield o(t)})}var Gs=function(){function e(o,r){if(this.jsonSchema=o,this.hashFunction=r,this.indexes=Xs(this.jsonSchema),this.primaryPath=_e(this.jsonSchema.primaryKey),!o.properties[this.primaryPath].maxLength)throw _("SC39",{schema:o});this.finalFields=Ro(this.jsonSchema)}var t=e.prototype;return t.validateChange=function(r,n){this.finalFields.forEach(s=>{if(!ze(r[s],n[s]))throw _("DOC9",{dataBefore:r,dataAfter:n,fieldName:s,schema:this.jsonSchema})})},t.getDocumentPrototype=function(){var r={},n=Le(this.jsonSchema,"");return Object.keys(n).forEach(s=>{var i=s;r.__defineGetter__(s,function(){if(!(!this.get||typeof this.get!="function")){var a=this.get(i);return a}}),Object.defineProperty(r,s+"$",{get:function(){return this.get$(i)},enumerable:!1,configurable:!1}),Object.defineProperty(r,s+"$$",{get:function(){return this.get$$(i)},enumerable:!1,configurable:!1}),Object.defineProperty(r,s+"_",{get:function(){return this.populate(i)},enumerable:!1,configurable:!1})}),re(this,"getDocumentPrototype",()=>r),r},t.getPrimaryOfDocumentData=function(r){return Ft(this.jsonSchema,r)},ue(e,[{key:"version",get:function(){return this.jsonSchema.version}},{key:"defaultValues",get:function(){var o={};return Object.entries(this.jsonSchema.properties).filter(([,r])=>Object.prototype.hasOwnProperty.call(r,"default")).forEach(([r,n])=>o[r]=n.default),re(this,"defaultValues",o)}},{key:"hash",get:function(){return re(this,"hash",this.hashFunction(JSON.stringify(this.jsonSchema)))}}])}();function Xs(e){return(e.indexes||[]).map(t=>nt(t)?t:[t])}function gu(e){var t=e.version?e.version:0,o=0;return new Array(t).fill(0).map(()=>o++)}function Io(e,t,o=!0){o&&V("preCreateRxSchema",e);var r=Lt(e);r=Do(r),P.deepFreezeWhenDevMode(r);var n=new Gs(r,t);return V("createRxSchema",n),n}var ut="\uFFFF",ct=Number.MIN_SAFE_INTEGER;function ko(e,t){var o=t.selector,r=e.indexes?e.indexes.slice(0):[];t.index&&(r=[t.index]);var n=!!t.sort.find(c=>Object.values(c)[0]==="desc"),s=new Set;Object.keys(o).forEach(c=>{var l=Le(e,c);l&&l.type==="boolean"&&Object.prototype.hasOwnProperty.call(o[c],"$eq")&&s.add(c)});var i=t.sort.map(c=>Object.keys(c)[0]),a=i.filter(c=>!s.has(c)).join(","),u=-1,m;if(r.forEach(c=>{var l=!0,g=!0,p=c.map(E=>{var O=o[E],j=O?Object.keys(O):[],A={};if(!O||!j.length){var U=g?ct:ut;A={startKey:U,endKey:l?ut:ct,inclusiveStart:!0,inclusiveEnd:!0}}else j.forEach(S=>{if(jt.has(S)){var B=O[S],J=ti(S,B);A=Object.assign(A,J)}});return typeof A.startKey>"u"&&(A.startKey=ct),typeof A.endKey>"u"&&(A.endKey=ut),typeof A.inclusiveStart>"u"&&(A.inclusiveStart=!0),typeof A.inclusiveEnd>"u"&&(A.inclusiveEnd=!0),g&&!A.inclusiveStart&&(g=!1),l&&!A.inclusiveEnd&&(l=!1),A}),h=p.map(E=>E.startKey),w=p.map(E=>E.endKey),y={index:c,startKeys:h,endKeys:w,inclusiveEnd:l,inclusiveStart:g,sortSatisfiedByIndex:!n&&a===c.filter(E=>!s.has(E)).join(","),selectorSatisfiedByIndex:ei(c,t.selector,h,w)},D=ri(e,t,y);(D>=u||t.index)&&(u=D,m=y)}),!m)throw _("SNH",{query:t});return m}var jt=new Set(["$eq","$gt","$gte","$lt","$lte"]),Js=new Set(["$eq","$gt","$gte"]),Zs=new Set(["$eq","$lt","$lte"]);function ei(e,t,o,r){var n=Object.entries(t),s=n.find(([S,B])=>{if(!e.includes(S))return!0;var J=Object.entries(B).find(([Ae,wr])=>!jt.has(Ae));return J});if(s||t.$and||t.$or)return!1;var i=[],a=new Set;for(var[u,m]of Object.entries(t)){if(!e.includes(u))return!1;var c=Object.keys(m).filter(S=>Js.has(S));if(c.length>1)return!1;var l=c[0];if(l&&a.add(u),l!=="$eq"){if(i.length>0)return!1;i.push(l)}}var g=[],p=new Set;for(var[h,w]of Object.entries(t)){if(!e.includes(h))return!1;var y=Object.keys(w).filter(S=>Zs.has(S));if(y.length>1)return!1;var D=y[0];if(D&&p.add(h),D!=="$eq"){if(g.length>0)return!1;g.push(D)}}var E=0;for(var O of e){for(var j of[a,p]){if(!j.has(O)&&j.size>0)return!1;j.delete(O)}var A=o[E],U=r[E];if(A!==U&&a.size>0&&p.size>0)return!1;E++}return!0}function ti(e,t){switch(e){case"$eq":return{startKey:t,endKey:t,inclusiveEnd:!0,inclusiveStart:!0};case"$lte":return{endKey:t,inclusiveEnd:!0};case"$gte":return{startKey:t,inclusiveStart:!0};case"$lt":return{endKey:t,inclusiveEnd:!1};case"$gt":return{startKey:t,inclusiveStart:!1};default:throw new Error("SNH")}}function ri(e,t,o){var r=0,n=c=>{c>0&&(r=r+c)},s=10,i=It(o.startKeys,c=>c!==ct&&c!==ut);n(i*s);var a=It(o.startKeys,c=>c!==ut&&c!==ct);n(a*s);var u=It(o.startKeys,(c,l)=>c===o.endKeys[l]);n(u*s*1.5);var m=o.sortSatisfiedByIndex?5:0;return n(m),r}var Z=class extends Error{},lt=Symbol("missing"),Po=Object.freeze(new Error("mingo: cycle detected while processing object/array")),Ht=e=>{let t=Wt(e),o=0,r=t.length;for(;r;)o=(o<<5)-o^t.charCodeAt(--r);return o>>>0},Ne=e=>typeof e!="object"&&typeof e!="function"||e===null,Fo=e=>Ne(e)||X(e)||ve(e),Lo={undefined:1,null:2,number:3,string:4,symbol:5,object:6,array:7,arraybuffer:8,boolean:9,date:10,regexp:11,function:12},W=(e,t)=>{e===lt&&(e=void 0),t===lt&&(t=void 0);let[o,r]=[e,t].map(n=>Lo[be(n)]||0);return o!==r?o-r:G(e,t)?0:e<t?-1:e>t?1:0},de=class e extends Map{#e=Ht;#r=new Map;#t=t=>{let o=this.#e(t);return[(this.#r.get(o)||[]).find(r=>G(r,t)),o]};constructor(){super()}static init(t){let o=new e;return t&&(o.#e=t),o}clear(){super.clear(),this.#r.clear()}delete(t){if(Ne(t))return super.delete(t);let[o,r]=this.#t(t);return super.delete(o)?(this.#r.set(r,this.#r.get(r).filter(n=>!G(n,o))),!0):!1}get(t){if(Ne(t))return super.get(t);let[o,r]=this.#t(t);return super.get(o)}has(t){if(Ne(t))return super.has(t);let[o,r]=this.#t(t);return super.has(o)}set(t,o){if(Ne(t))return super.set(t,o);let[r,n]=this.#t(t);if(super.has(r))super.set(r,o);else{super.set(t,o);let s=this.#r.get(n)||[];s.push(t),this.#r.set(n,s)}return this}get size(){return super.size}};function d(e,t){if(!e)throw new Z(t)}var oi=Object.keys(Lo).reduce((e,t)=>(e["[object "+t[0].toUpperCase()+t.substring(1)+"]"]=t,e),{});function be(e){let t=Object.prototype.toString.call(e);return t==="[object Object]"?e?.constructor?.name?.toLowerCase()||"object":oi[t]||t.substring(8,t.length-1).toLowerCase()}var Oe=e=>typeof e=="boolean",R=e=>typeof e=="string",ni=e=>typeof e=="symbol",b=e=>!isNaN(e)&&typeof e=="number";var x=Array.isArray;function C(e){if(!e)return!1;let t=Object.getPrototypeOf(e);return(t===Object.prototype||t===null)&&be(e)==="object"}var Bo=e=>!Ne(e),X=e=>e instanceof Date,ve=e=>e instanceof RegExp,mt=e=>typeof e=="function",v=e=>e==null,ye=(e,t=!0)=>!!e||t&&e==="",oe=e=>v(e)||R(e)&&!e||x(e)&&e.length===0||C(e)&&Object.keys(e).length===0,xe=e=>x(e)?e:[e],le=(e,t)=>!!e&&Object.prototype.hasOwnProperty.call(e,t),si=e=>typeof ArrayBuffer<"u"&&ArrayBuffer.isView(e),Ee=(e,t)=>{if(v(e)||Oe(e)||b(e)||R(e))return e;if(X(e))return new Date(e);if(ve(e))return new RegExp(e);if(si(e)){let o=e.constructor;return new o(e)}if(t instanceof Set||(t=new Set),t.has(e))throw Po;t.add(e);try{if(x(e)){let o=new Array(e.length);for(let r=0;r<e.length;r++)o[r]=Ee(e[r],t);return o}if(C(e)){let o={};for(let r of Object.keys(e))o[r]=Ee(e[r],t);return o}}finally{t.delete(e)}return e},Ao=e=>e===lt;function Kt(e,t){if(Ao(e)||v(e))return t;if(Ao(t)||v(t))return e;if(Ne(e)||Ne(t))return t;x(e)&&x(t)&&d(e.length===t.length,"arrays must be of equal length to merge.");for(let o of Object.keys(t))e[o]=Kt(e[o],t[o]);return e}function Cr(e,t=Ht){let o=[de.init(t),de.init(t)];if(e.length===0)return[];if(e.some(r=>r.length===0))return[];if(e.length===1)return[...e];e[e.length-1].forEach(r=>o[0].set(r,!0));for(let r=e.length-2;r>-1;r--){if(e[r].forEach(n=>{o[0].has(n)&&o[1].set(n,!0)}),o[1].size===0)return[];o.reverse(),o[1].clear()}return Array.from(o[0].keys())}function Me(e,t=1){let o=new Array;function r(n,s){for(let i=0,a=n.length;i<a;i++)x(n[i])&&(s>0||s<0)?r(n[i],Math.max(-1,s-1)):o.push(n[i])}return r(e,t),o}function ii(e){let t={};for(;e;){for(let o of Object.getOwnPropertyNames(e))o in t||(t[o]=e[o]);e=Object.getPrototypeOf(e)}return t}function Uo(e){for(;e;){if(Object.getOwnPropertyNames(e).includes("toString"))return e.toString!==Object.prototype.toString;e=Object.getPrototypeOf(e)}return!1}function G(e,t){if(e===t||Object.is(e,t))return!0;if(e===null||t===null||typeof e!=typeof t||typeof e!="object"||e.constructor!==t.constructor)return!1;if(e instanceof Date)return+e==+t;if(e instanceof RegExp)return e.toString()===t.toString();let o=e.constructor;if(o===Array||o===Object){let r=Object.keys(e).sort(),n=Object.keys(t).sort();if(r.length!==n.length)return!1;for(let s=0,i=r[s];s<r.length;i=r[++s])if(i!==n[s]||!G(e[i],t[i]))return!1;return!0}return Uo(e)&&e.toString()===t.toString()}var Wt=(e,t)=>{if(e===null)return"null";if(e===void 0)return"undefined";if(R(e)||b(e)||Oe(e))return JSON.stringify(e);if(X(e))return e.toISOString();if(ve(e)||ni(e)||mt(e))return e.toString();if(t instanceof Set||(t=new Set),t.has(e))throw Po;try{if(t.add(e),x(e))return"["+e.map(r=>Wt(r,t)).join(",")+"]";if(C(e))return"{"+Object.keys(e).sort().map(n=>`${n}:${Wt(e[n],t)}`).join()+"}";let o=Uo(e)?e.toString():Wt(ii(e),t);return be(e)+"("+o+")"}finally{t.delete(e)}};function Vo(e,t){return v(e)?null:(t=t||Ht,t(e))}function Qt(e,t,o=Ht){if(e.length<1)return new Map;let r=new Map,n=new Map;for(let s=0;s<e.length;s++){let i=e[s],a=t(i,s),u=Vo(a,o);if(u===null)n.has(null)?n.get(null).push(i):n.set(null,[i]);else{let m=r.has(u)?r.get(u).find(c=>G(c,a)):null;v(m)?(n.set(a,[i]),r.has(u)?r.get(u).push(a):r.set(u,[a])):n.get(m).push(i)}}return n}function Nr(e,t){return Bo(e)?e[t]:void 0}function ai(e,t){if(t<1)return e;for(;t--&&e.length===1;)e=e[0];return e}function Q(e,t,o){let r=0;function n(i,a){let u=i;for(let m=0;m<a.length;m++){let c=a[m];if(/^\d+$/.exec(c)===null&&x(u)){if(m===0&&r>0)break;r+=1;let g=a.slice(m);u=u.reduce((p,h)=>{let w=n(h,g);return w!==void 0&&p.push(w),p},[]);break}else u=Nr(u,c);if(u===void 0)break}return u}let s=Fo(e)?e:n(e,t.split("."));return x(s)&&o?.unwrapArray?ai(s,r):s}function Ce(e,t,o){let r=t.indexOf("."),n=r==-1?t:t.substring(0,r),s=t.substring(r+1),i=r!=-1;if(x(e)){let m=/^\d+$/.test(n),c=m&&o?.preserveIndex?[...e]:[];if(m){let l=parseInt(n),g=Nr(e,l);i&&(g=Ce(g,s,o)),o?.preserveIndex?c[l]=g:c.push(g)}else for(let l of e){let g=Ce(l,t,o);o?.preserveMissing?c.push(g??lt):(g!=null||o?.preserveIndex)&&c.push(g)}return c}let a=o?.preserveKeys?M({},e):{},u=Nr(e,n);if(i&&(u=Ce(u,s,o)),u!==void 0)return a[n]=u,a}function qt(e){if(x(e))for(let t=e.length-1;t>=0;t--)e[t]===lt?e.splice(t,1):qt(e[t]);else if(C(e))for(let t in e)le(e,t)&&qt(e[t])}var To=/^\d+$/;function zt(e,t,o,r){let n=t.split("."),s=n[0],i=n.slice(1).join(".");if(n.length===1)(C(e)||x(e)&&To.test(s))&&o(e,s);else{r?.buildGraph&&v(e[s])&&(e[s]={});let a=e[s];if(!a)return;let u=!!(n.length>1&&To.test(n[1]));x(a)&&r?.descendArray&&!u?a.forEach(m=>zt(m,i,o,r)):zt(a,i,o,r)}}function ft(e,t,o){zt(e,t,(r,n)=>{r[n]=mt(o)?o(r[n]):o},{buildGraph:!0})}function pt(e,t,o){zt(e,t,(r,n)=>{if(x(r)){if(/^\d+$/.test(n))r.splice(parseInt(n),1);else if(o&&o.descendArray)for(let s of r)C(s)&&delete s[n]}else C(r)&&delete r[n]},o)}var ui=/^\$[a-zA-Z0-9_]+$/;function me(e){return ui.test(e)}function Yt(e){if(Fo(e))return ve(e)?{$regex:e}:{$eq:e};if(Bo(e)){if(!Object.keys(e).some(me))return{$eq:e};if(le(e,"$regex")){let t=M({},e);return t.$regex=new RegExp(e.$regex,e.$options),delete t.$options,t}}return e}var Ke=(e=>(e[e.CLONE_OFF=0]="CLONE_OFF",e[e.CLONE_INPUT=1]="CLONE_INPUT",e[e.CLONE_OUTPUT=2]="CLONE_OUTPUT",e[e.CLONE_ALL=3]="CLONE_ALL",e))(Ke||{}),F=class e{#e;#r;#t;constructor(t,o,r){this.#e=t,this.update(o,r)}static init(t,o,r){return t instanceof e?new e(t.#e,t.root??o,L(M(M({},t.#t),r),{variables:Object.assign({},t.#t?.variables,r?.variables)})):new e(t,o,r)}update(t,o){this.#r=t;let r=Object.assign({},this.#t?.variables,o?.variables);return Object.keys(r).length?this.#t=L(M({},o),{variables:r}):this.#t=o??{},this}getOptions(){return Object.freeze(L(M({},this.#e),{context:He.from(this.#e.context)}))}get root(){return this.#r}get local(){return this.#t}get idKey(){return this.#e.idKey}get collation(){return this.#e?.collation}get processingMode(){return this.#e?.processingMode||0}get useStrictMode(){return this.#e?.useStrictMode}get scriptEnabled(){return this.#e?.scriptEnabled}get useGlobalContext(){return this.#e?.useGlobalContext}get hashFunction(){return this.#e?.hashFunction}get collectionResolver(){return this.#e?.collectionResolver}get jsonSchemaValidator(){return this.#e?.jsonSchemaValidator}get variables(){return this.#e?.variables}get context(){return this.#e?.context}};function ht(e){return e instanceof F?e.getOptions():Object.freeze(L(M({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:0},e),{context:e?.context?He.from(e?.context):He.init()}))}var He=class e{#e=new Map;constructor(){}static init(){return new e}static from(t){let o=e.init();return v(t)||t.#e.forEach((r,n)=>o.addOperators(n,r)),o}addOperators(t,o){this.#e.has(t)||this.#e.set(t,{});for(let[r,n]of Object.entries(o))this.getOperator(t,r)||(this.#e.get(t)[r]=n);return this}getOperator(t,o){return(this.#e.get(t)??{})[o]??null}addAccumulatorOps(t){return this.addOperators("accumulator",t)}addExpressionOps(t){return this.addOperators("expression",t)}addQueryOps(t){return this.addOperators("query",t)}addPipelineOps(t){return this.addOperators("pipeline",t)}addProjectionOps(t){return this.addOperators("projection",t)}addWindowOps(t){return this.addOperators("window",t)}},Ue=He.init();function Mr(e,t){for(let[o,r]of Object.entries(t)){d(mt(r)&&me(o),`'${o}' is not a valid operator`);let n=Se(e,o,null);d(!n||r===n,`${o} already exists for '${e}' operators. Cannot change operator function once registered.`)}switch(e){case"accumulator":Ue.addAccumulatorOps(t);break;case"expression":Ue.addExpressionOps(t);break;case"pipeline":Ue.addPipelineOps(t);break;case"projection":Ue.addProjectionOps(t);break;case"query":Ue.addQueryOps(t);break;case"window":Ue.addWindowOps(t);break}}function Se(e,t,o){let{context:r,useGlobalContext:n}=o||{},s=r?r.getOperator(e,t):null;return!s&&n?Ue.getOperator(e,t):s}function f(e,t,o,r){let n=F.init(r,e);return o&&me(o)?jo(e,t,o,n):Gt(e,t,n)}var ci=["$$ROOT","$$CURRENT","$$REMOVE","$$NOW"];function Gt(e,t,o){if(R(t)&&t.length>0&&t[0]==="$"){if(li.includes(t))return t;let r=o.root,n=t.split(".");if(ci.includes(n[0])){switch(n[0]){case"$$ROOT":break;case"$$CURRENT":r=e;break;case"$$REMOVE":r=void 0;break;case"$$NOW":r=new Date;break}t=t.slice(n[0].length+1)}else if(n[0].slice(0,2)==="$$"){r=Object.assign({},o.variables,{this:e},o?.local?.variables);let s=n[0].slice(2);d(le(r,s),`Use of undefined variable: ${s}`),t=t.slice(2)}else t=t.slice(1);return t===""?r:Q(r,t)}if(x(t))return t.map(r=>Gt(e,r,o));if(C(t)){let r={},n=Object.entries(t);for(let[s,i]of n){if(me(s))return d(n.length==1,"expression must have single operator."),jo(e,i,s,o);r[s]=Gt(e,i,o)}return r}return t}function jo(e,t,o,r){let n=Se("expression",o,r);if(n)return n(e,t,r);let s=Se("accumulator",o,r);return d(!!s,`accumulator '${o}' is not registered.`),x(e)||(e=Gt(e,t,r),t=null),d(x(e),`arguments must resolve to array for ${o}.`),s(e,t,r)}var li=["$$KEEP","$$PRUNE","$$DESCEND"];function z(e){return e instanceof dt?e:new dt(e)}function gt(...e){let t=0;return z(()=>{for(;t<e.length;){let o=e[t].next();if(!o.done)return o;t++}return{done:!0}})}function mi(e){return!!e&&typeof e=="object"&&e?.next instanceof Function}function fi(e,t){let o=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,o)}var Ir=new Error;function pi(e,t,o){let r=!1,n=-1,s=0;return function(i){try{e:for(;!r;){let a=e();n++;let u=-1,m=t.length,c=!1;for(;++u<m;){let l=t[u];switch(l.action){case 0:a=l.func(a,n);break;case 1:if(!l.func(a,n))continue e;break;case 2:--l.count,l.count||(c=!0);break;case 3:--l.count,l.count||fi(t,u);continue e;default:break e}}if(r=c,i)o[s++]=a;else return{value:a,done:!1}}}catch(a){if(a!==Ir)throw a}return r=!0,{done:r}}}var dt=class{constructor(t){this.#e=[],this.#r=[],this.isDone=!1;let o;if(t instanceof Function&&(t={next:t}),mi(t)){let r=t;o=()=>{let n=r.next();if(n.done)throw Ir;return n.value}}else if(x(t)){let r=t,n=r.length,s=0;o=()=>{if(s<n)return r[s++];throw Ir}}else if(!(t instanceof Function))throw new Z("Lazy must be initialized with an array, generator, or function.");this.#t=pi(o,this.#e,this.#r)}#e;#r;#t;push(t,o){return typeof o=="function"?this.#e.push({action:t,func:o}):typeof o=="number"&&this.#e.push({action:t,count:o}),this}next(){return this.#t()}map(t){return this.push(0,t)}filter(t){return this.push(1,t)}take(t){return t>0?this.push(2,t):this}drop(t){return t>0?this.push(3,t):this}transform(t){let o=this,r;return z(()=>(r||(r=z(t(o.value()))),r.next()))}value(){return this.isDone||(this.isDone=this.#t(!0).done),this.#r}each(t){for(;;){let o=this.next();if(o.done)break;if(t(o.value)===!1)return!1}return!0}reduce(t,o){let r=this.next();for(o===void 0&&!r.done&&(o=r.value,r=this.next());!r.done;)o=t(o,r.value),r=this.next();return o}size(){return this.reduce((t,o)=>++t,0)}[Symbol.iterator](){return this}};var Wo=(e,t,o)=>e.take(t);var vt=(e,t,o)=>oe(t)?e:(zo(t,o),e.map(qo(t,F.init(o))));function qo(e,t,o=!0){let r=t.idKey,n=Object.keys(e),s=new Array,i=new Array,a={};for(let p of n){let h=e[p];if(b(h)||Oe(h))h?i.push(p):s.push(p);else if(x(h))a[p]=w=>h.map(y=>f(w,y,null,t.update(w))??null);else if(C(h)){let w=Object.keys(h),y=w.length==1?w[0]:"",D=Se("projection",y,t);D?y==="$slice"&&!xe(h[y]).every(b)?a[p]=O=>f(O,h,p,t.update(O)):a[p]=O=>D(O,h[y],p,t.update(O)):me(y)?a[p]=E=>f(E,h[y],y,t):(zo(h,t),a[p]=E=>{if(!le(E,p))return f(E,h,null,t);o&&t.update(E);let O=Q(E,p),j=qo(h,t,!1);return x(O)?O.map(j):C(O)?j(O):j(E)})}else a[p]=R(h)&&h[0]==="$"?w=>f(w,h,p,t):w=>h}let u=Object.keys(a),m=s.includes(r);if(o&&m&&s.length===1&&!i.length&&!u.length)return p=>{let h=M({},p);return delete h[r],h};let l=o&&!m&&!i.includes(r),g={preserveMissing:!0};return p=>{let h={};if(s.length&&!i.length){Kt(h,p);for(let w of s)pt(h,w,{descendArray:!0})}for(let w of i){let y=Ce(p,w,g)??{};Kt(h,y)}i.length&&qt(h);for(let w of u){let y=a[w](p);y===void 0?pt(h,w,{descendArray:!0}):ft(h,w,y)}return l&&le(p,r)&&(h[r]=Q(p,r)),h}}function zo(e,t){let o=!1,r=!1;for(let[n,s]of Object.entries(e))d(!n.startsWith("$"),"Field names may not start with '$'."),d(!n.endsWith(".$"),"Positional projection operator '$' is not supported."),n!==t?.idKey&&(s===0||s===!1?o=!0:(s===1||s===!0)&&(r=!0),d(!(o&&r),"Projection cannot have a mix of inclusion and exclusion."))}var Ho=(e,t,o)=>e.drop(t);var we=(e,t,o)=>{if(oe(t)||!C(t))return e;let r=W,n=o.collation;return C(n)&&R(n.locale)&&(r=di(n)),e.transform(s=>{let i=Object.keys(t);for(let a of i.reverse()){let u=Qt(s,l=>Q(l,a),o.hashFunction),m=Array.from(u.keys()).sort(r);t[a]===-1&&m.reverse();let c=0;for(let l of m)for(let g of u.get(l))s[c++]=g;d(c==s.length,"bug: counter must match collection size.")}return s})},hi={1:"base",2:"accent",3:"variant"};function di(e){let t={sensitivity:hi[e.strength||3],caseFirst:e.caseFirst==="off"?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:e.alternate==="shifted"};(e.caseLevel||!1)===!0&&(t.sensitivity==="base"&&(t.sensitivity="case"),t.sensitivity==="accent"&&(t.sensitivity="variant"));let o=new Intl.Collator(e.locale,t);return(r,n)=>{if(!R(r)||!R(n))return W(r,n);let s=o.compare(r,n);return s<0?-1:s>0?1:0}}var gi={$sort:we,$skip:Ho,$limit:Wo},Xt=class{#e;#r;#t;#n;#i={};#o=null;#s=[];constructor(t,o,r,n){this.#e=t,this.#r=o,this.#t=r,this.#n=n}fetch(){if(this.#o)return this.#o;this.#o=z(this.#e).filter(this.#r);let t=this.#n.processingMode;t&Ke.CLONE_INPUT&&this.#o.map(Ee);for(let o of["$sort","$skip","$limit"])le(this.#i,o)&&(this.#o=gi[o](this.#o,this.#i[o],this.#n));return Object.keys(this.#t).length&&(this.#o=vt(this.#o,this.#t,this.#n)),t&Ke.CLONE_OUTPUT&&this.#o.map(Ee),this.#o}fetchAll(){let t=z([...this.#s]);return this.#s=[],gt(t,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(t){return this.#i.$skip=t,this}limit(t){return this.#i.$limit=t,this}sort(t){return this.#i.$sort=t,this}collation(t){return this.#n=L(M({},this.#n),{collation:t}),this}next(){if(this.#s.length>0)return this.#s.pop();let t=this.fetch().next();if(!t.done)return t.value}hasNext(){if(this.#s.length>0)return!0;let t=this.fetch().next();return t.done?!1:(this.#s.push(t.value),!0)}map(t){return this.all().map(t)}forEach(t){this.all().forEach(t)}[Symbol.iterator](){return this.fetchAll()}};var vi=new Set(Array.from(["$and","$or","$nor","$expr","$jsonSchema"])),ne=class{#e;#r;#t;constructor(t,o){this.#t=Ee(t),this.#r=ht(o),this.#e=[],this.compile()}compile(){d(C(this.#t),`query criteria must be an object: ${JSON.stringify(this.#t)}`);let t={};for(let[o,r]of Object.entries(this.#t)){if(o==="$where")d(this.#r.scriptEnabled,"$where operator requires 'scriptEnabled' option to be true."),Object.assign(t,{field:o,expr:r});else if(vi.has(o))this.processOperator(o,o,r);else{d(!me(o),`unknown top level operator: ${o}`);for(let[n,s]of Object.entries(Yt(r)))this.processOperator(o,n,s)}t.field&&this.processOperator(t.field,t.field,t.expr)}}processOperator(t,o,r){let n=Se("query",o,this.#r);d(!!n,`unknown query operator ${o}`),this.#e.push(n(t,r,this.#r))}test(t){return this.#e.every(o=>o(t))}find(t,o){return new Xt(t,r=>this.test(r),o||{},this.#r)}remove(t){return t.reduce((o,r)=>(this.test(r)||o.push(r),o),[])}};var uc=Object.freeze({R5:[10,16,25,40,63],R10:[100,125,160,200,250,315,400,500,630,800],R20:[100,112,125,140,160,180,200,224,250,280,315,355,400,450,500,560,630,710,800,900],R40:[100,106,112,118,125,132,140,150,160,170,180,190,200,212,224,236,250,265,280,300,315,355,375,400,425,450,475,500,530,560,600,630,670,710,750,800,850,900,950],R80:[103,109,115,122,128,136,145,155,165,175,185,195,206,218,230,243,258,272,290,307,325,345,365,387,412,437,462,487,515,545,575,615,650,690,730,775,825,875,925,975],"1-2-5":[10,20,50],E6:[10,15,22,33,47,68],E12:[10,12,15,18,22,27,33,39,47,56,68,82],E24:[10,11,12,13,15,16,18,20,22,24,27,30,33,36,39,43,47,51,56,62,68,75,82,91],E48:[100,105,110,115,121,127,133,140,147,154,162,169,178,187,196,205,215,226,237,249,261,274,287,301,316,332,348,365,383,402,422,442,464,487,511,536,562,590,619,649,681,715,750,787,825,866,909,953],E96:[100,102,105,107,110,113,115,118,121,124,127,130,133,137,140,143,147,150,154,158,162,165,169,174,178,182,187,191,196,200,205,210,215,221,226,232,237,243,249,255,261,267,274,280,287,294,301,309,316,324,332,340,348,357,365,374,383,392,402,412,422,432,442,453,464,475,487,499,511,523,536,549,562,576,590,604,619,634,649,665,681,698,715,732,750,768,787,806,825,845,866,887,909,931,953,976],E192:[100,101,102,104,105,106,107,109,110,111,113,114,115,117,118,120,121,123,124,126,127,129,130,132,133,135,137,138,140,142,143,145,147,149,150,152,154,156,158,160,162,164,165,167,169,172,174,176,178,180,182,184,187,189,191,193,196,198,200,203,205,208,210,213,215,218,221,223,226,229,232,234,237,240,243,246,249,252,255,258,261,264,267,271,274,277,280,284,287,291,294,298,301,305,309,312,316,320,324,328,332,336,340,344,348,352,357,361,365,370,374,379,383,388,392,397,402,407,412,417,422,427,432,437,442,448,453,459,464,470,475,481,487,493,499,505,511,517,523,530,536,542,549,556,562,569,576,583,590,597,604,612,619,626,634,642,649,657,665,673,681,690,698,706,715,723,732,741,750,759,768,777,787,796,806,816,825,835,845,856,866,876,887,898,909,920,931,942,953,965,976,988]});var Qo=7;var Qe=1e3*60*60*24,Yo={week:Qe*Qo,day:Qe,hour:1e3*60*60,minute:1e3*60,second:1e3,millisecond:1},yi=["monday","mon","tuesday","tue","wednesday","wed","thursday","thu","friday","fri","saturday","sat","sunday","sun"],xi=new Set(yi),vc=Object.freeze({mon:1,tue:2,wed:3,thu:4,fri:5,sat:6,sun:7});var Go=Object.freeze({"%Y":{name:"year",padding:4,re:/([0-9]{4})/},"%G":{name:"year",padding:4,re:/([0-9]{4})/},"%m":{name:"month",padding:2,re:/(0[1-9]|1[012])/},"%d":{name:"day",padding:2,re:/(0[1-9]|[12][0-9]|3[01])/},"%H":{name:"hour",padding:2,re:/([01][0-9]|2[0-3])/},"%M":{name:"minute",padding:2,re:/([0-5][0-9])/},"%S":{name:"second",padding:2,re:/([0-5][0-9]|60)/},"%L":{name:"millisecond",padding:3,re:/([0-9]{3})/},"%u":{name:"weekday",padding:1,re:/([1-7])/},"%U":{name:"week",padding:2,re:/([1-4][0-9]?|5[0-3]?)/},"%V":{name:"isoWeek",padding:2,re:/([1-4][0-9]?|5[0-3]?)/},"%z":{name:"timezone",padding:2,re:/(([+-][01][0-9]|2[0-3]):?([0-5][0-9])?)/},"%Z":{name:"minuteOffset",padding:3,re:/([+-][0-9]{3})/}});var Rc=Object.freeze({});var Ym={week:Qe*7,day:Qe,hour:Qe/24,minute:6e4,second:1e3,millisecond:1};function k(e){return(o,r,n)=>{let s={unwrapArray:!0},i=Math.max(1,o.split(".").length-1);return a=>{let u=Q(a,o,s);return e(u,r,L(M({},n),{depth:i}))}}}function ee(e){return(t,o,r)=>{let n=f(t,o,null,r);return e(...n)}}function yt(e,t,o){return G(e,t)||v(e)&&v(t)?!0:x(e)?e.some(r=>G(r,t))||Me(e,o?.depth).some(r=>G(r,t)):!1}function Jt(e,t,o){return!yt(e,t,o)}function Ar(e,t,o){return v(e)?t.some(r=>r===null):Cr([xe(e),t],o?.hashFunction).length>0}function Zt(e,t,o){return!Ar(e,t,o)}function er(e,t,o){return nr(e,t,(r,n)=>W(r,n)<0)}function tr(e,t,o){return nr(e,t,(r,n)=>W(r,n)<=0)}function rr(e,t,o){return nr(e,t,(r,n)=>W(r,n)>0)}function or(e,t,o){return nr(e,t,(r,n)=>W(r,n)>=0)}function tn(e,t,o){return xe(e).some(r=>t.length===2&&r%t[0]===t[1])}function rn(e,t,o){let r=xe(e),n=s=>R(s)&&ye(t.exec(s),o?.useStrictMode);return r.some(n)||Me(r,1).some(n)}function on(e,t,o){if(!x(e)||!x(t)||!e.length||!t.length)return!1;let r=!0;for(let n of t){if(!r)break;C(n)&&Object.keys(n).includes("$elemMatch")?r=Tr(e,n.$elemMatch,o):ve(n)?r=e.some(s=>typeof s=="string"&&n.test(s)):r=e.some(s=>G(n,s))}return r}function nn(e,t,o){return Array.isArray(e)&&e.length===t}function Mi(e){return me(e)&&["$and","$or","$nor"].indexOf(e)===-1}function Tr(e,t,o){if(x(e)&&!oe(e)){let r=i=>i,n=t;Object.keys(t).every(Mi)&&(n={temp:t},r=i=>({temp:i}));let s=new ne(n,o);for(let i=0,a=e.length;i<a;i++)if(s.test(r(e[i])))return!0}return!1}var Zo=e=>e===null,Ii={array:x,boolean:Oe,bool:Oe,date:X,number:b,int:b,long:b,double:b,decimal:b,null:Zo,object:C,regexp:ve,regex:ve,string:R,undefined:v,function:e=>{throw new Z("unsupported type key `function`.")},1:b,2:R,3:C,4:x,6:v,8:Oe,9:X,10:Zo,11:ve,16:b,18:b,19:b};function en(e,t,o){let r=Ii[t];return r?r(e):!1}function sn(e,t,o){return x(t)?t.findIndex(r=>en(e,r,o))>=0:en(e,t,o)}function nr(e,t,o){return xe(e).some(r=>be(r)===be(t)&&o(r,t))}var fd=ee(Zt);var Ye=(e,t)=>(o,r,n)=>{d(x(r),`${e}: expression must be an array.`);let s=f(o,r,null,n);return s.some(v)?null:(d(s.every(b),`${e}: expression must evalue to array of numbers.`),t(s))};var cg=Ye("$bitAnd",e=>e.reduce((t,o)=>t&o,-1));var dg=Ye("$bitOr",e=>e.reduce((t,o)=>t|o,0));var yg=Ye("$bitXor",e=>e.reduce((t,o)=>t^o,0));var jg=ee(yt);var zg=ee(rr);var Qg=ee(or);var Xg=ee(er);var ev=ee(tr);var ov=ee(Jt);var an=(e,t)=>{let o={};return e.split("").forEach((r,n)=>o[r]=t*(n+1)),o},Fv=L(M(M({},an("ABCDEFGHIKLM",1)),an("NOPQRSTUVWXY",-1)),{Z:0});var mn={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};function T(e,t=mn){let o=Object.assign({},mn,t),r=new Set(Object.keys(o));return(n,s,i)=>{let a=f(n,s,null,i);if(r.has(`${a}`)){let u=o[`${a}`];if(u instanceof Error)throw new Z(`cannot apply $${e.name} to -inf, value must in (-inf,inf)`);return u}return e(a)}}var Jw=T(Math.acos,{Infinity:1/0,0:new Error});var t$=T(Math.acosh,{Infinity:1/0,0:new Error});var n$=T(Math.asin);var a$=T(Math.asinh,{Infinity:1/0,"-Infinity":-1/0});var l$=T(Math.atan);var g$=T(Math.atanh,{1:1/0,"-1":-1/0});var x$=T(Math.cos);var _$=T(Math.cosh,{"-Infinity":1/0,Infinity:1/0});var Vi=Math.PI/180,O$=T(e=>e*Vi,{Infinity:1/0,"-Infinity":1/0});var ji=180/Math.PI,R$=T(e=>e*ji,{Infinity:1/0,"-Infinity":-1/0});var M$=T(Math.sin);var A$=T(Math.sinh,{"-Infinity":-1/0,Infinity:1/0});var F$=T(Math.tan);var Wi=Number.MAX_SAFE_INTEGER,qi=Number.MIN_SAFE_INTEGER;var pn=(e,t,o)=>{d(x(t),"Invalid expression: $and expects value to be an Array.");let r=t.map(n=>new ne(n,o));return n=>r.every(s=>s.test(n))};var ir=(e,t,o)=>{d(x(t),"Invalid expression. $or expects value to be an Array");let r=t.map(n=>new ne(n,o));return n=>r.some(s=>s.test(n))};var hn=(e,t,o)=>{d(x(t),"Invalid expression. $nor expects value to be an array.");let r=ir("$or",t,o);return n=>!r(n)};var dn=(e,t,o)=>{let r={};r[e]=Yt(t);let n=new ne(r,o);return s=>!n.test(s)};var Pr=k(yt);var Fr=k(rr);var Lr=k(or);var Br=k(Ar);var Ur=k(er);var Vr=k(tr);var jr=k(Jt);var Wr=k(Zt);var gn=k(tn);var vn=k(rn);var Bb=k(on);var yn=k(Tr);var xn=k(nn);var wn=(e,t,o)=>{let r=e.includes("."),n=!!t;return!r||e.match(/\.\d+$/)?s=>Q(s,e)!==void 0===n:s=>{let i=Ce(s,e,{preserveIndex:!0}),a=Q(i,e.substring(0,e.lastIndexOf(".")));return x(a)?a.some(u=>u!==void 0)===n:a!==void 0===n}};var $n=k(sn);var _n=!1;function En(e){return _n||(Mr("pipeline",{$sort:we,$project:vt}),Mr("query",{$and:pn,$eq:Pr,$elemMatch:yn,$exists:wn,$gt:Fr,$gte:Lr,$in:Br,$lt:Ur,$lte:Vr,$ne:jr,$nin:Wr,$mod:gn,$nor:hn,$not:dn,$or:ir,$regex:vn,$size:xn,$type:$n}),_n=!0),new ne(e)}function Ie(e,t){var o=_e(e.primaryKey);t=q(t);var r=ce(t);if(typeof r.skip!="number"&&(r.skip=0),r.selector?(r.selector=r.selector,Object.entries(r.selector).forEach(([l,g])=>{(typeof g!="object"||g===null)&&(r.selector[l]={$eq:g})})):r.selector={},r.index){var n=ho(r.index);n.includes(o)||n.push(o),r.index=n}if(r.sort){var c=r.sort.find(l=>vo(l)===o);c||(r.sort=r.sort.slice(0),r.sort.push({[o]:"asc"}))}else if(r.index)r.sort=r.index.map(l=>({[l]:"asc"}));else{if(e.indexes){var s=new Set;Object.entries(r.selector).forEach(([l,g])=>{var p=!1;typeof g=="object"&&g!==null?p=!!Object.keys(g).find(h=>jt.has(h)):p=!0,p&&s.add(l)});var i=-1,a;e.indexes.forEach(l=>{var g=nt(l)?l:[l],p=g.findIndex(h=>!s.has(h));p>0&&p>i&&(i=p,a=g)}),a&&(r.sort=a.map(l=>({[l]:"asc"})))}if(!r.sort)if(e.indexes&&e.indexes.length>0){var u=e.indexes[0],m=nt(u)?u:[u];r.sort=m.map(l=>({[l]:"asc"}))}else r.sort=[{[o]:"asc"}]}return r}function bn(e,t){if(!t.sort)throw _("SNH",{query:t});var o=[];t.sort.forEach(n=>{var s=Object.keys(n)[0],i=Object.values(n)[0];o.push({key:s,direction:i,getValueFn:go(s)})});var r=(n,s)=>{for(var i=0;i<o.length;++i){var a=o[i],u=a.getValueFn(n),m=a.getValueFn(s);if(u!==m){var c=a.direction==="asc"?W(u,m):W(m,u);return c}}};return r}function ar(e,t){if(!t.sort)throw _("SNH",{query:t});var o=En(t.selector),r=n=>o.test(n);return r}function Ge(e,t){return $(this,null,function*(){var o=yield e.exec();if(!o)return null;if(Array.isArray(o))return Promise.all(o.map(n=>t(n)));if(o instanceof Map)return Promise.all([...o.values()].map(n=>t(n)));var r=yield t(o);return r})}function Xe(e,t){if(!t.sort)throw _("SNH",{query:t});var o=ko(e,t);return{query:t,queryPlan:o}}function On(e){return e.documentData?e.documentData:e.previousDocumentData}function Sn(e){switch(e.operation){case"INSERT":return{operation:e.operation,id:e.documentId,doc:e.documentData,previous:null};case"UPDATE":return{operation:e.operation,id:e.documentId,doc:P.deepFreezeWhenDevMode(e.documentData),previous:e.previousDocumentData?e.previousDocumentData:"UNKNOWN"};case"DELETE":return{operation:e.operation,id:e.documentId,doc:null,previous:e.previousDocumentData}}}var Yi=new Map;function ur(e){return Y(Yi,e,()=>{for(var t=new Array(e.events.length),o=e.events,r=e.collectionName,n=e.isLocal,s=P.deepFreezeWhenDevMode,i=0;i<o.length;i++){var a=o[i];t[i]={documentId:a.documentId,collectionName:r,isLocal:n,operation:a.operation,documentData:s(a.documentData),previousDocumentData:s(a.previousDocumentData)}}return t})}var Dn="_rxdb_internal";function wt(e,t){return $(this,null,function*(){var o=yield e.findDocumentsById([t],!1),r=o[0];if(r)return r})}function zr(e,t,o){return $(this,null,function*(){var r=yield e.bulkWrite([t],o);if(r.error.length>0){var n=r.error[0];throw n}else{var s=_e(e.schema.primaryKey),i=fe(s,[t],r),a=i[0];return a}})}function CO(e){return Object.assign({},...e.filter(t=>!!t))}function Je(e,t,o,r){if(r)throw r.status===409?_("CONFLICT",{collection:e.name,id:t,writeError:r,data:o}):r.status===422?_("VD2",{collection:e.name,id:t,writeError:r,data:o}):r}function MO(e,t,o,r,n,s,i){for(var a=!!e.schema.attachments,u=[],m=[],c=[],l=Pe(10),g={id:l,events:[],checkpoint:null,context:n},p=g.events,h=[],w=[],y=[],D=o.size>0,E,O=r.length,j=function(){var U=r[A],S=U.document,B=U.previous,J=S[t],Ae=S._deleted,wr=B&&B._deleted,rt=void 0;D&&(rt=o.get(J));var Te;if(rt){var Ws=rt._rev;if(!B||B&&Ws!==B._rev){var qs={isError:!0,status:409,documentId:J,writeRow:U,documentInDb:rt};return c.push(qs),1}var St=a?qr(U):U;a&&(Ae?B&&Object.keys(B._attachments).forEach(te=>{w.push({documentId:J,attachmentId:te,digest:N(B)._attachments[te].digest})}):(Object.entries(S._attachments).find(([te,pe])=>{var Nt=B?B._attachments[te]:void 0;return!Nt&&!pe.data&&(Te={documentId:J,documentInDb:rt,isError:!0,status:510,writeRow:U,attachmentId:te}),!0}),Te||Object.entries(S._attachments).forEach(([te,pe])=>{var Nt=B?B._attachments[te]:void 0;if(!Nt)h.push({documentId:J,attachmentId:te,attachmentData:pe,digest:pe.digest});else{var Hs=St.document._attachments[te].digest;pe.data&&Nt.digest!==Hs&&y.push({documentId:J,attachmentId:te,attachmentData:pe,digest:pe.digest})}}))),Te?c.push(Te):(a?(m.push(qr(St)),i&&i(S)):(m.push(St),i&&i(S)),E=St);var Dt=null,$r=null,Rt=null;if(wr&&!Ae)Rt="INSERT",Dt=a?$e(S):S;else if(B&&!wr&&!Ae)Rt="UPDATE",Dt=a?$e(S):S,$r=B;else if(Ae)Rt="DELETE",Dt=N(S),$r=B;else throw _("SNH",{args:{writeRow:U}});var zs={documentId:J,documentData:Dt,previousDocumentData:$r,operation:Rt};p.push(zs)}else{var Vs=!!Ae;if(a&&Object.entries(S._attachments).forEach(([te,pe])=>{pe.data?h.push({documentId:J,attachmentId:te,attachmentData:pe,digest:pe.digest}):(Te={documentId:J,isError:!0,status:510,writeRow:U,attachmentId:te},c.push(Te))}),Te||(a?(u.push(qr(U)),s&&s(S)):(u.push(U),s&&s(S)),E=U),!Vs){var js={documentId:J,operation:"INSERT",documentData:a?$e(S):S,previousDocumentData:a&&B?$e(B):B};p.push(js)}}},A=0;A<O;A++)j();return{bulkInsertDocs:u,bulkUpdateDocs:m,newestRow:E,errors:c,eventBulk:g,attachmentsAdd:h,attachmentsRemove:w,attachmentsUpdate:y}}function qr(e){return{previous:e.previous,document:$e(e.document)}}function Gi(e){return atob(e).length}function Xi(e){var t=e.data;if(!t)return e;var o={length:Gi(t),digest:e.digest,type:e.type};return o}function $e(e){if(!e._attachments||Object.keys(e._attachments).length===0)return e;var t=q(e);return t._attachments={},Object.entries(e._attachments).forEach(([o,r])=>{t._attachments[o]=Xi(r)}),t}function $t(e){return Object.assign({},e,{_meta:q(e._meta)})}function cr(e,t,o){P.deepFreezeWhenDevMode(o);var r=_e(t.schema.primaryKey),n={originalStorageInstance:t,schema:t.schema,internals:t.internals,collectionName:t.collectionName,databaseName:t.databaseName,options:t.options,bulkWrite(i,a){return $(this,null,function*(){for(var u=e.token,m=new Array(i.length),c=he(),l=0;l<i.length;l++){var g=i[l],p=$t(g.document);p._meta.lwt=c;var h=g.previous;p._rev=at(u,h),m[l]={document:p,previous:h}}V("preStorageWrite",{storageInstance:this.originalStorageInstance,rows:m});var w=yield e.lockedRun(()=>t.bulkWrite(m,a)),y={error:[]};Rn.set(y,m);var D=w.error.length===0?[]:w.error.filter(S=>S.status===409&&!S.writeRow.previous&&!S.writeRow.document._deleted&&N(S.documentInDb)._deleted?!0:(y.error.push(S),!1));if(D.length>0){var E=new Set,O=D.map(S=>(E.add(S.documentId),{previous:S.documentInDb,document:Object.assign({},S.writeRow.document,{_rev:at(e.token,S.documentInDb)})})),j=yield e.lockedRun(()=>t.bulkWrite(O,a));De(y.error,j.error);var A=fe(r,m,y,E),U=fe(r,O,j);return De(A,U),y}return y})},query(i){return e.lockedRun(()=>t.query(i))},count(i){return e.lockedRun(()=>t.count(i))},findDocumentsById(i,a){return e.lockedRun(()=>t.findDocumentsById(i,a))},getAttachmentData(i,a,u){return e.lockedRun(()=>t.getAttachmentData(i,a,u))},getChangedDocumentsSince:t.getChangedDocumentsSince?(i,a)=>e.lockedRun(()=>t.getChangedDocumentsSince(N(i),a)):void 0,cleanup(i){return e.lockedRun(()=>t.cleanup(i))},remove(){return e.storageInstances.delete(n),e.lockedRun(()=>t.remove())},close(){return e.storageInstances.delete(n),e.lockedRun(()=>t.close())},changeStream(){return t.changeStream()}};return e.storageInstances.add(n),n}function IO(e){if(e.schema.keyCompression)throw _("UT5",{args:{params:e}});if(Ji(e.schema))throw _("UT6",{args:{params:e}});if(e.schema.attachments&&e.schema.attachments.compression)throw _("UT7",{args:{params:e}})}function Ji(e){return!!(e.encrypted&&e.encrypted.length>0||e.attachments&&e.attachments.encrypted)}function Zi(e,t,o){var r=_e(e.schema.primaryKey),n=o?o.lwt:xo,s=o?o.id:"";return Ie(e.schema,{selector:{$or:[{"_meta.lwt":{$gt:n}},{"_meta.lwt":{$eq:n},[r]:{$gt:o?s:""}}],"_meta.lwt":{$gte:n}},sort:[{"_meta.lwt":"asc"},{[r]:"asc"}],skip:0,limit:t})}function kO(e,t,o){return $(this,null,function*(){if(e.getChangedDocumentsSince)return e.getChangedDocumentsSince(t,o);var r=_e(e.schema.primaryKey),n=Xe(e.schema,Zi(e,t,o)),s=yield e.query(n),i=s.documents,a=po(i);return{documents:i,checkpoint:a?{id:a[r],lwt:a._meta.lwt}:o||{id:"",lwt:0}}})}var Rn=new WeakMap,ea=new WeakMap;function fe(e,t,o,r){return Y(ea,o,()=>{var n=[],s=Rn.get(o);if(s||(s=t),o.error.length>0||r){for(var i=r||new Set,a=0;a<o.error.length;a++){var u=o.error[a];i.add(u.documentId)}for(var m=0;m<s.length;m++){var c=s[m].document;i.has(c[e])||n.push($e(c))}}else{n.length=t.length-o.error.length;for(var l=0;l<s.length;l++){var g=s[l].document;n[l]=$e(g)}}return n})}var Nn=function(){function e(o,r,n,s){this.queueByDocId=new Map,this.isRunning=!1,this.storageInstance=o,this.primaryPath=r,this.preWrite=n,this.postWrite=s}var t=e.prototype;return t.addWrite=function(r,n){var s=r[this.primaryPath],i=Y(this.queueByDocId,s,()=>[]),a=new Promise((u,m)=>{var c={lastKnownDocumentState:r,modifier:n,resolve:u,reject:m};N(i).push(c),this.triggerRun()});return a},t.triggerRun=function(){return $(this,null,function*(){if(!(this.isRunning===!0||this.queueByDocId.size===0)){this.isRunning=!0;var r=[],n=this.queueByDocId;this.queueByDocId=new Map,yield Promise.all(Array.from(n.entries()).map(u=>$(this,[u],function*([i,a]){var m=ta(a.map(g=>g.lastKnownDocumentState)),c=m;for(var l of a)try{c=yield l.modifier(ce(c))}catch(g){l.reject(g),l.reject=()=>{},l.resolve=()=>{}}try{yield this.preWrite(c,m)}catch(g){a.forEach(p=>p.reject(g));return}r.push({previous:m,document:c})})));var s=r.length>0?yield this.storageInstance.bulkWrite(r,"incremental-write"):{error:[]};return yield Promise.all(fe(this.primaryPath,r,s).map(i=>{var a=i[this.primaryPath];this.postWrite(i);var u=Fe(n,a);u.forEach(m=>m.resolve(i))})),s.error.forEach(i=>{var a=i.documentId,u=Fe(n,a),m=qe(i);if(m){var c=Y(this.queueByDocId,a,()=>[]);u.reverse().forEach(g=>{g.lastKnownDocumentState=N(m.documentInDb),N(c).unshift(g)})}else{var l=kt(i);u.forEach(g=>g.reject(l))}}),this.isRunning=!1,this.triggerRun()}})},e}();function Hr(e){var t=o=>$(null,null,function*(){var r=wo(o);r._deleted=o._deleted;var n=yield e(r),s=Object.assign({},n,{_meta:o._meta,_attachments:o._attachments,_rev:o._rev,_deleted:typeof n._deleted<"u"?n._deleted:o._deleted});return typeof s._deleted>"u"&&(s._deleted=!1),s});return t}function ta(e){var t=e[0],o=Be(t._rev);return e.forEach(r=>{var n=Be(r._rev);n>o&&(t=r,o=n)}),t}var Kr={get primaryPath(){var e=this;if(e.isInstanceOfRxDocument)return e.collection.schema.primaryPath},get primary(){var e=this;if(e.isInstanceOfRxDocument)return e._data[e.primaryPath]},get revision(){var e=this;if(e.isInstanceOfRxDocument)return e._data._rev},get deleted$(){var e=this;if(e.isInstanceOfRxDocument)return e.$.pipe(ae(t=>t._data._deleted))},get deleted$$(){var e=this,t=e.collection.database.getReactivityFactory();return t.fromObservable(e.deleted$,e.getLatest().deleted,e.collection.database)},get deleted(){var e=this;if(e.isInstanceOfRxDocument)return e._data._deleted},getLatest(){var e=this.collection._docCache.getLatestDocumentData(this.primary);return this.collection._docCache.getCachedRxDocument(e)},get $(){var e=this,t=this.primary;return e.collection.eventBulks$.pipe(K(o=>!o.isLocal),ae(o=>o.events.find(r=>r.documentId===t)),K(o=>!!o),ae(o=>On(N(o))),Mt(e.collection._docCache.getLatestDocumentData(t)),ot((o,r)=>o._rev===r._rev),ae(o=>this.collection._docCache.getCachedRxDocument(o)),Ct(Pt))},get $$(){var e=this,t=e.collection.database.getReactivityFactory();return t.fromObservable(e.$,e.getLatest()._data,e.collection.database)},get$(e){if(P.isDevMode()){if(e.includes(".item."))throw _("DOC1",{path:e});if(e===this.primaryPath)throw _("DOC2");if(this.collection.schema.finalFields.includes(e))throw _("DOC3",{path:e});var t=Le(this.collection.schema.jsonSchema,e);if(!t)throw _("DOC4",{path:e})}return this.$.pipe(ae(o=>Er(o,e)),ot())},get$$(e){var t=this.get$(e),o=this.collection.database.getReactivityFactory();return o.fromObservable(t,this.getLatest().get(e),this.collection.database)},populate(e){var t=Le(this.collection.schema.jsonSchema,e),o=this.get(e);if(!o)return Eo;if(!t)throw _("DOC5",{path:e});if(!t.ref)throw _("DOC6",{path:e,schemaObj:t});var r=this.collection.database.collections[t.ref];if(!r)throw _("DOC7",{ref:t.ref,path:e,schemaObj:t});return t.type==="array"?r.findByIds(o).exec().then(n=>{var s=n.values();return Array.from(s)}):r.findOne(o).exec()},get(e){return In(this,e)},toJSON(e=!1){if(e)return P.deepFreezeWhenDevMode(this._data);var t=q(this._data);return delete t._rev,delete t._attachments,delete t._deleted,delete t._meta,P.deepFreezeWhenDevMode(t)},toMutableJSON(e=!1){return ce(this.toJSON(e))},update(e){throw I("update")},incrementalUpdate(e){throw I("update")},updateCRDT(e){throw I("crdt")},putAttachment(){throw I("attachments")},putAttachmentBase64(){throw I("attachments")},getAttachment(){throw I("attachments")},allAttachments(){throw I("attachments")},get allAttachments$(){throw I("attachments")},modify(e,t){return $(this,null,function*(){var o=this._data,r=yield Hr(e)(o);return this._saveData(r,o)})},incrementalModify(e,t){return this.collection.incrementalWriteQueue.addWrite(this._data,Hr(e)).then(o=>this.collection._docCache.getCachedRxDocument(o))},patch(e){var t=this._data,o=ce(t);return Object.entries(e).forEach(([r,n])=>{o[r]=n}),this._saveData(o,t)},incrementalPatch(e){return this.incrementalModify(t=>(Object.entries(e).forEach(([o,r])=>{t[o]=r}),t))},_saveData(e,t){return $(this,null,function*(){if(e=q(e),this._data._deleted)throw _("DOC11",{id:this.primary,document:this});yield Qr(this.collection,e,t);var o=[{previous:t,document:e}],r=yield this.collection.storageInstance.bulkWrite(o,"rx-document-save-data"),n=r.error[0];return Je(this.collection,this.primary,e,n),yield this.collection._runHooks("post","save",e,this),this.collection._docCache.getCachedRxDocument(fe(this.collection.schema.primaryPath,o,r)[0])})},remove(){return $(this,null,function*(){if(this.deleted)return Promise.reject(_("DOC13",{document:this,id:this.primary}));var e=yield this.collection.bulkRemove([this]);if(e.error.length>0){var t=e.error[0];Je(this.collection,this.primary,this._data,t)}return e.success[0]})},incrementalRemove(){return this.incrementalModify(e=>$(this,null,function*(){return yield this.collection._runHooks("pre","remove",e,this),e._deleted=!0,e})).then(e=>$(this,null,function*(){return yield this.collection._runHooks("post","remove",e._data,e),e}))},close(){throw _("DOC14")}};function Cn(e=Kr){var t=function(r,n){this.collection=r,this._data=n,this._propertyCache=new Map,this.isInstanceOfRxDocument=!0};return t.prototype=e,t}function Mn(e,t,o){var r=new e(t,o);return V("createRxDocument",r),r}function Qr(e,t,o){return t._meta=Object.assign({},o._meta,t._meta),P.isDevMode()&&e.schema.validateChange(o,t),e._runHooks("pre","save",t,o)}function In(e,t){return Y(e._propertyCache,t,()=>{var o=Er(e._data,t);if(typeof o!="object"||o===null||Array.isArray(o))return P.deepFreezeWhenDevMode(o);var r=new Proxy(q(o),{get(n,s){if(typeof s!="string")return n[s];var i=s.charAt(s.length-1);if(i==="$")if(s.endsWith("$$")){var a=s.slice(0,-2);return e.get$$(it(t+"."+a))}else{var u=s.slice(0,-1);return e.get$(it(t+"."+u))}else if(i==="_"){var m=s.slice(0,-1);return e.populate(it(t+"."+m))}else{var c=n[s];return typeof c=="number"||typeof c=="string"||typeof c=="boolean"?c:In(e,it(t+"."+s))}}});return r})}var ke="collection",Yr="storage-token",ra="rx-migration-status",oa="rx-pipeline-checkpoint",na="RxInternalDocument",lr=Lt({version:0,title:na,primaryKey:{key:"id",fields:["context","key"],separator:"|"},type:"object",properties:{id:{type:"string",maxLength:200},key:{type:"string"},context:{type:"string",enum:[ke,Yr,ra,oa,"OTHER"]},data:{type:"object",additionalProperties:!0}},indexes:[],required:["key","context","data"],additionalProperties:!1,sharding:{shards:1,mode:"collection"}});function Ze(e,t){return Ft(lr,{key:e,context:t})}function mr(e){return $(this,null,function*(){var t=Xe(e.schema,{selector:{context:ke,_deleted:{$eq:!1}},sort:[{id:"asc"}],skip:0}),o=yield e.query(t),r=o.documents;return r})}var kn="storageToken",sa=Ze(kn,Yr);function An(e){return $(this,null,function*(){var t=Pe(10),o=e.password?yield e.hashFunction(JSON.stringify(e.password)):void 0,r={id:sa,context:Yr,key:kn,data:{rxdbVersion:e.rxdbVersion,token:t,instanceToken:e.token,passwordHash:o},_deleted:!1,_meta:je(),_rev:We(),_attachments:{}},n=[{document:r}],s=yield e.internalStore.bulkWrite(n,"internal-add-storage-token");if(!s.error[0])return fe("id",n,s)[0];var i=N(s.error[0]);if(i.isError&&qe(i)){var a=i;if(!ia(a.documentInDb.data.rxdbVersion,e.rxdbVersion))throw _("DM5",{args:{database:e.name,databaseStateVersion:a.documentInDb.data.rxdbVersion,codeVersion:e.rxdbVersion}});if(o&&o!==a.documentInDb.data.passwordHash)throw _("DB1",{passwordHash:o,existingPasswordHash:a.documentInDb.data.passwordHash});var u=a.documentInDb;return N(u)}throw i})}function ia(e,t){if(!e)return!1;var o=e.split(".")[0],r=t.split(".")[0];return o==="15"&&r==="16"?!0:o===r}function oS(e,t,o){return $(this,null,function*(){if(e.schema.version!==o.version)throw _("SNH",{schema:o,version:e.schema.version,name:e.name,collection:e,args:{storageCollectionName:t}});for(var r=_t(e.name,e.schema.jsonSchema),n=Ze(r,ke);;){var s=yield wt(e.database.internalStore,n),i=ce(N(s)),a=i.data.connectedStorages.find(u=>u.collectionName===t&&u.schema.version===o.version);if(a)return;i.data.connectedStorages.push({collectionName:t,schema:o});try{yield zr(e.database.internalStore,{previous:N(s),document:i},"add-connected-storage-to-collection")}catch(u){if(!qe(u))throw u}}})}function nS(e,t,o){return $(this,null,function*(){if(e.schema.version!==o.version)throw _("SNH",{schema:o,version:e.schema.version,name:e.name,collection:e,args:{storageCollectionName:t}});for(var r=_t(e.name,e.schema.jsonSchema),n=Ze(r,ke);;){var s=yield wt(e.database.internalStore,n),i=ce(N(s)),a=i.data.connectedStorages.find(u=>u.collectionName===t&&u.schema.version===o.version);if(!a)return;i.data.connectedStorages=i.data.connectedStorages.filter(u=>u.collectionName!==t);try{yield zr(e.database.internalStore,{previous:N(s),document:i},"remove-connected-storage-from-collection")}catch(u){if(!qe(u))throw u}}})}function _t(e,t){return e+"-"+t.version}function Et(e,t){return t=q(t),t=No(e,t),typeof e.jsonSchema.primaryKey!="string"&&(t=So(e.primaryPath,e.jsonSchema,t)),t._meta=je(),Object.prototype.hasOwnProperty.call(t,"_deleted")||(t._deleted=!1),Object.prototype.hasOwnProperty.call(t,"_attachments")||(t._attachments={}),Object.prototype.hasOwnProperty.call(t,"_rev")||(t._rev=We()),t}function Tn(e,t){return $(this,null,function*(){t.multiInstance=e.multiInstance;var o=yield e.storage.createStorageInstance(t);return o})}function fr(e,t,o,r,n,s,i,a){return $(this,null,function*(){var u=yield mr(t),m=u.filter(p=>p.data.name===n),c=[];m.forEach(p=>{c.push({collectionName:p.data.name,schema:p.data.schema,isCollection:!0}),p.data.connectedStorages.forEach(h=>c.push({collectionName:h.collectionName,isCollection:!1,schema:h.schema}))});var l=new Set;if(c=c.filter(p=>{var h=p.collectionName+"||"+p.schema.version;return l.has(h)?!1:(l.add(h),!0)}),yield Promise.all(c.map(p=>$(null,null,function*(){var h=yield e.createStorageInstance({collectionName:p.collectionName,databaseInstanceToken:o,databaseName:r,multiInstance:s,options:{},schema:p.schema,password:i,devMode:P.isDevMode()});yield h.remove(),p.isCollection&&(yield Re("postRemoveRxCollection",{storage:e,databaseName:r,collectionName:n}))}))),a){var g=m.map(p=>{var h=$t(p);return h._deleted=!0,h._meta.lwt=he(),h._rev=at(o,p),{previous:p,document:h}});yield t.bulkWrite(g,"rx-database-remove-collection-all")}})}function ie(e){if(e.closed)throw _("COL21",{collection:e.name,version:e.schema.version})}function pr(e){return e[e.length-1]}function aa(e){let t=typeof e;return e!==null&&(t==="object"||t==="function")}function Gr(e,t,o){if(Array.isArray(t)&&(t=t.join(".")),!aa(e)||typeof t!="string")return o===void 0?e:o;let r=t.split(".");if(r.length===0)return o;for(let n=0;n<r.length;n++){let s=r[n];if(ua(e,s)?e=n===r.length-1?void 0:null:e=e[s],e==null){if(n!==r.length-1)return o;break}}return e===void 0?o:e}function ua(e,t){if(typeof t!="number"&&Array.isArray(e)){let o=Number.parseInt(t,10);return Number.isInteger(o)&&e[o]===e[t]}return!1}var Xr=e=>!!e.queryParams.limit,Pn=e=>e.queryParams.limit===1,Fn=e=>!!(e.queryParams.skip&&e.queryParams.skip>0),Ln=e=>e.changeEvent.operation==="DELETE",Bn=e=>e.changeEvent.operation==="INSERT",Un=e=>e.changeEvent.operation==="UPDATE",Vn=e=>Xr(e)&&e.previousResults.length>=e.queryParams.limit,jn=e=>{let t=e.queryParams.sortFields,o=e.changeEvent.previous,r=e.changeEvent.doc;if(!r)return!1;if(!o)return!0;for(let n=0;n<t.length;n++){let s=t[n],i=Gr(o,s),a=Gr(r,s);if(i!==a)return!0}return!1},Wn=e=>{let t=e.changeEvent.id;if(e.keyDocumentMap)return e.keyDocumentMap.has(t);{let o=e.queryParams.primaryKey,r=e.previousResults;for(let n=0;n<r.length;n++)if(r[n][o]===t)return!0;return!1}},qn=e=>{let t=e.previousResults[0];return!!(t&&t[e.queryParams.primaryKey]===e.changeEvent.id)},zn=e=>{let t=pr(e.previousResults);return!!(t&&t[e.queryParams.primaryKey]===e.changeEvent.id)},Hn=e=>{let t=e.changeEvent.previous;if(!t)return!1;let o=e.previousResults[0];return o?o[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,o)<0:!1},Kn=e=>{let t=e.changeEvent.previous;if(!t)return!1;let o=pr(e.previousResults);return o?o[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,o)>0:!1},Qn=e=>{let t=e.changeEvent.doc;if(!t)return!1;let o=e.previousResults[0];return o?o[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,o)<0:!1},Yn=e=>{let t=e.changeEvent.doc;if(!t)return!1;let o=pr(e.previousResults);return o?o[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,o)>0:!1},Gn=e=>{let t=e.changeEvent.previous;return t?e.queryParams.queryMatcher(t):!1},Xn=e=>{let t=e.changeEvent.doc;return t?e.queryParams.queryMatcher(t):!1},Jn=e=>e.previousResults.length===0;var Zn={0:Bn,1:Un,2:Ln,3:Xr,4:Pn,5:Fn,6:Jn,7:Vn,8:qn,9:zn,10:jn,11:Wn,12:Hn,13:Kn,14:Qn,15:Yn,16:Gn,17:Xn};function es(e,t,o,r){var n=e.length,s=n-1,i=0;if(n===0)return e.push(t),0;for(var a;r<=s;)i=r+(s-r>>1),a=e[i],o(a,t)<=0?r=i+1:s=i-1;return o(a,t)<=0&&i++,e.splice(i,0,t),i}var ts=e=>{},hr=e=>{e.previousResults.unshift(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},dr=e=>{e.previousResults.push(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},gr=e=>{let t=e.previousResults.shift();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},vr=e=>{let t=e.previousResults.pop();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},rs=e=>{gr(e),dr(e)},os=e=>{vr(e),hr(e)},ns=e=>{gr(e),hr(e)},ss=e=>{vr(e),dr(e)},Jr=e=>{e.keyDocumentMap&&e.keyDocumentMap.delete(e.changeEvent.id);let t=e.queryParams.primaryKey,o=e.previousResults;for(let r=0;r<o.length;r++)if(o[r][t]===e.changeEvent.id){o.splice(r,1);break}},is=e=>{let t=e.changeEvent.doc,o=e.queryParams.primaryKey,r=e.previousResults;for(let n=0;n<r.length;n++)if(r[n][o]===e.changeEvent.id){r[n]=t,e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,t);break}},as=e=>{let t={_id:"wrongHuman"+new Date().getTime()};e.previousResults.length=0,e.previousResults.push(t),e.keyDocumentMap&&(e.keyDocumentMap.clear(),e.keyDocumentMap.set(t._id,t))},Zr=e=>{let t=e.changeEvent.id,o=e.changeEvent.doc;if(e.keyDocumentMap){if(e.keyDocumentMap.has(t))return;e.keyDocumentMap.set(t,o)}else if(e.previousResults.find(n=>n[e.queryParams.primaryKey]===t))return;es(e.previousResults,o,e.queryParams.sortComparator,0)},us=e=>{Jr(e),Zr(e)},cs=e=>{throw new Error("Action runFullQueryAgain must be implemented by yourself")},ls=e=>{throw new Error("Action unknownAction should never be called")};var ms=["doNothing","insertFirst","insertLast","removeFirstItem","removeLastItem","removeFirstInsertLast","removeLastInsertFirst","removeFirstInsertFirst","removeLastInsertLast","removeExisting","replaceExisting","alwaysWrong","insertAtSortPosition","removeExistingAndInsertAtSortPosition","runFullQueryAgain","unknownAction"],fs={doNothing:ts,insertFirst:hr,insertLast:dr,removeFirstItem:gr,removeLastItem:vr,removeFirstInsertLast:rs,removeLastInsertFirst:os,removeFirstInsertFirst:ns,removeLastInsertLast:ss,removeExisting:Jr,replaceExisting:is,alwaysWrong:as,insertAtSortPosition:Zr,removeExistingAndInsertAtSortPosition:us,runFullQueryAgain:cs,unknownAction:ls};function yr(e){return e.charCodeAt(0)-40}function ps(e){return e?"1":"0"}function ca(e=6){let t="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=o.length;for(let n=0;n<e;n++)t+=o.charAt(Math.floor(Math.random()*r));return t}var NS=ca(4);function eo(e,t){let o=[];for(let r=0,n=e.length;r<n;r+=t)o.push(e.substring(r,r+t));return o}function hs(e){let t=new Map,r=2+parseInt(e.charAt(0)+e.charAt(1),10)*2,n=e.substring(2,r),s=eo(n,2);for(let w=0;w<s.length;w++){let y=s[w],D=y.charAt(0),E=yr(y.charAt(1));t.set(D,E)}let i=e.substring(r,e.length-3),a=eo(i,4);for(let w=0;w<a.length;w++){let y=a[w],D=y.charAt(0),E=y.charAt(1),O=y.charAt(2),j=yr(y.charAt(3));if(!t.has(E))throw new Error("missing node with id "+E);if(!t.has(O))throw new Error("missing node with id "+O);let A=t.get(E),U=t.get(O),S={l:j,0:A,1:U};t.set(D,S)}let u=e.slice(-3),m=u.charAt(0),c=u.charAt(1),l=yr(u.charAt(2)),g=t.get(m),p=t.get(c);return{l,0:g,1:p}}function ds(e,t,o){let r=e,n=e.l;for(;;){let s=t[n](o),i=ps(s);if(r=r[i],typeof r=="number"||typeof r=="string")return r;n=r.l}}var la="14a1b,c+d2e5f0g/h.i4j*k-l)m(n6oeh6pnm6qen6ril6snh6tin6ubo9vce9wmh9xns9yne9zmi9{cm9|ad9}cp9~aq9\x7Fae9\xA1bf9\xA2bq9\xA3cg9\xA4ck9\xA5cn9\xA6nd9\xA7np9\xA8nq9\xA9nf9\xAAng9\xABnm9\xACnk9\xADmr9\xAEms9\xAFmt9\xB0mj9\xB1mk9\xB2ml9\xB3mn9\xB4mc8\xB5\xB3{8\xB6\xAF}8\xB7\xB0\xA48\xB8\xB3\xA78\xB9mn8\xBA\xB3\xAB8\xBB\xB3m8\xBCm\xB44\xBDz\xB24\xBE\xB3w4\xBFz\xB54\xC0\xAF\xB64\xC1\xB0\xB74\xC2\xB3\xBA4\xC3\xB3\xB84\xC4m\xB94\xC5v\xA47\xC6yn7\xC7\xC0\xC17\xC8~\x7F7\xC9\xA5\xA47\xCA\xC3\xC47\xCB\xA8n7\xCC\xBA\xB97\xCD\xAD\xB07\xCE\xAEm7\xCF\xAF\xB07\xD0\xB1m7\xD1\xB3m7\xD2\xBCm5\xD3\xC4m5\xD4\xB9m5\xD5\xBD\xB05\xD6\xBEm5\xD7\xBF\xB05\xD8\xC7\xCF5\xD9\xC2m5\xDA\xCA\xD15\xDB\xB1m5\xDC\xBAm5\xDD\xCC\xD15\xDE\xD5\xCD2\xDF|\x7F2\xE0\xA1u2\xE1\xA3\xC52\xE2\xD6\xCE2\xE3\xA6\xC62\xE4\xA9x2\xE5\xAA\xC62\xE6\xD7\xD82\xE7|\xC82\xE8\xA1\xA22\xE9\xA3\xC92\xEA\xA4\xA52\xEB\xD9\xDA2\xEC\xA6\xCB2\xED\xA9n2\xEE\xAAn2\xEF\xDB\xD02\xF0\xDC\xDD2\xF1\xACn2\xF2\xD2\xD3/\xF3an/\xF4bn/\xF5cn/\xF6\xDE\xE2/\xF7\xDF\xE3/\xF8\xE0\xE4/\xF9\xE1\xE5/\xFA\xE6\xEB/\xFB\xE7\xEC/\xFC\xE8\xED/\xFD\xE9\xEE/\xFE\xCD\xCE/\xFF\xCF\xD1/\u0100\xF2\xD4,\u0101cn,\u0102\xF6\xEF,\u0103\xA4\xF1,\u0104\xFA\xF0,\u0105\xEA\xF1,\u0106\xFE\xD0,\u0107\xFF\xD1,\u0108ac0\u0109bc0\u010A\xF3\xF50\u010B\xF4\u01010\u010C\xDF\xE10\u010D\xE0\xA40\u010E\xE7\xE90\u010F\xE8\xEA0\u0110\xF7\xF90\u0111\xF8\u01030\u0112\xFB\xFD0\u0113\xFC\u01050\u0114m\xD2-\u0115m\u0100-\u0116\xDE\xE6-\u0117\u010C\u010E-\u0118\u010D\u010F-\u0119\u0102\u0104-\u011A\u0110\u0112-\u011B\u0111\u0113-\u011C\xB2\xBB-\u011D\xCD\xCF-\u011E\u0106\u0107-\u011F\xB2\xB3-\u0120\u0114\u01083\u0121\u0115\u010A3\u0122\u0116\u01173\u0123\u0119\u011A3\u0124\u0122\u011D(\u0125\u011C\u011F(\u0126\u0123\u011E(\u0127\u0120\u0121+\u0128\u0109\u010B+\u0129\u0124\u0126+\u012A\u0118\u011B+\u012B\u0127\u01281\u012C\u0129\u012A1\u012D\u012C\u012B*\u012E\u0125m*\u012D\u012E.",to;function ma(){return to||(to=hs(la)),to}var gs=e=>ds(ma(),Zn,e);function vs(e){let t=gs(e);return ms[t]}function ys(e,t,o,r,n){let s=fs[e];return s({queryParams:t,changeEvent:o,previousResults:r,keyDocumentMap:n}),r}function fa(e,t){return!t.sort||t.sort.length===0?[e]:t.sort.map(o=>Object.keys(o)[0])}var pa=new WeakMap;function ha(e){return Y(pa,e,()=>{var t=e.collection,o=Ie(t.storageInstance.schema,ce(e.mangoQuery)),r=t.schema.primaryPath,n=bn(t.schema.jsonSchema,o),s=(m,c)=>{var l={docA:m,docB:c,rxQuery:e};return n(l.docA,l.docB)},i=ar(t.schema.jsonSchema,o),a=m=>{var c={doc:m,rxQuery:e};return i(c.doc)},u={primaryKey:e.collection.schema.primaryPath,skip:o.skip,limit:o.limit,sortFields:fa(r,o),sortComparator:s,queryMatcher:a};return u})}function xs(e,t){if(!e.collection.database.eventReduce)return{runFullQueryAgain:!0};for(var o=ha(e),r=N(e._result).docsData.slice(0),n=N(e._result).docsDataMap,s=!1,i=[],a=0;a<t.length;a++){var u=t[a],m=Sn(u);m&&i.push(m)}var c=i.find(l=>{var g={queryParams:o,changeEvent:l,previousResults:r,keyDocumentMap:n},p=vs(g);if(p==="runFullQueryAgain")return!0;if(p!=="doNothing")return s=!0,ys(p,o,l,r,n),!1});return c?{runFullQueryAgain:!0}:{runFullQueryAgain:!1,changed:s,newResults:r}}var da=function(){function e(){this._map=new Map}var t=e.prototype;return t.getByQuery=function(r){var n=r.toString(),s=Y(this._map,n,()=>r);return s},e}();function $s(){return new da}function ws(e,t){t.uncached=!0;var o=t.toString();e._map.delete(o)}function ga(e){return e.refCount$.observers.length}var va=100,ya=30*1e3,xa=(e,t)=>(o,r)=>{if(!(r._map.size<e)){var n=he()-t,s=[],i=Array.from(r._map.values());for(var a of i)if(!(ga(a)>0)){if(a._lastEnsureEqual===0&&a._creationTime<n){ws(r,a);continue}s.push(a)}var u=s.length-e;if(!(u<=0)){var m=s.sort((l,g)=>l._lastEnsureEqual-g._lastEnsureEqual),c=m.slice(0,u);c.forEach(l=>ws(r,l))}}},oo=xa(va,ya),ro=new WeakSet;function _s(e){ro.has(e)||(ro.add(e),_o().then(()=>bo(200)).then(()=>{e.closed||e.cacheReplacementPolicy(e,e._queryCache),ro.delete(e)}))}var bs=function(){function e(o,r,n){this.cacheItemByDocId=new Map,this.tasks=new Set,this.registry=typeof FinalizationRegistry=="function"?new FinalizationRegistry(s=>{var i=s.docId,a=this.cacheItemByDocId.get(i);a&&(a[0].delete(s.revisionHeight+s.lwt+""),a[0].size===0&&this.cacheItemByDocId.delete(i))}):void 0,this.primaryPath=o,this.changes$=r,this.documentCreator=n,r.subscribe(s=>{this.tasks.add(()=>{for(var i=this.cacheItemByDocId,a=0;a<s.length;a++){var u=s[a],m=i.get(u.documentId);if(m){var c=u.documentData;c||(c=u.previousDocumentData),m[1]=c}}}),this.tasks.size<=1&&st().then(()=>{this.processTasks()})})}var t=e.prototype;return t.processTasks=function(){if(this.tasks.size!==0){var r=Array.from(this.tasks);r.forEach(n=>n()),this.tasks.clear()}},t.getLatestDocumentData=function(r){this.processTasks();var n=Fe(this.cacheItemByDocId,r);return n[1]},t.getLatestDocumentDataIfExists=function(r){this.processTasks();var n=this.cacheItemByDocId.get(r);if(n)return n[1]},ue(e,[{key:"getCachedRxDocuments",get:function(){var o=Es(this);return re(this,"getCachedRxDocuments",o)}},{key:"getCachedRxDocument",get:function(){var o=Es(this);return re(this,"getCachedRxDocument",r=>o([r])[0])}}])}();function Es(e){var t=e.primaryPath,o=e.cacheItemByDocId,r=e.registry,n=P.deepFreezeWhenDevMode,s=e.documentCreator,i=a=>{for(var u=new Array(a.length),m=[],c=0;c<a.length;c++){var l=a[c],g=l[t],p=Be(l._rev),h=void 0,w=void 0,y=o.get(g);y?(h=y[0],w=h.get(p+l._meta.lwt+"")):(h=new Map,y=[h,l],o.set(g,y));var D=w?w.deref():void 0;D||(l=n(l),D=s(l),h.set(p+l._meta.lwt+"",$a(D)),r&&m.push(D)),u[c]=D}return m.length>0&&r&&(e.tasks.add(()=>{for(var E=0;E<m.length;E++){var O=m[E];r.register(O,{docId:O.primary,revisionHeight:Be(O.revision),lwt:O._data._meta.lwt})}}),e.tasks.size<=1&&st().then(()=>{e.processTasks()})),u};return i}function bt(e,t){var o=e.getCachedRxDocuments;return o(t)}var wa=typeof WeakRef=="function",$a=wa?_a:Ea;function _a(e){return new WeakRef(e)}function Ea(e){return{deref(){return e}}}var no=function(){function e(o,r,n){this.time=he(),this.query=o,this.count=n,this.documents=bt(this.query.collection._docCache,r)}var t=e.prototype;return t.getValue=function(r){var n=this.query.op;if(n==="count")return this.count;if(n==="findOne"){var s=this.documents.length===0?null:this.documents[0];if(!s&&r)throw _("QU10",{collection:this.query.collection.name,query:this.query.mangoQuery,op:n});return s}else return n==="findByIds"?this.docsMap:this.documents.slice(0)},ue(e,[{key:"docsData",get:function(){return re(this,"docsData",this.documents.map(o=>o._data))}},{key:"docsDataMap",get:function(){var o=new Map;return this.documents.forEach(r=>{o.set(r.primary,r._data)}),re(this,"docsDataMap",o)}},{key:"docsMap",get:function(){for(var o=new Map,r=this.documents,n=0;n<r.length;n++){var s=r[n];o.set(s.primary,s)}return re(this,"docsMap",o)}}])}();var ba=0,Oa=function(){return++ba},Sa=function(){function e(o,r,n,s={}){this.id=Oa(),this._execOverDatabaseCount=0,this._creationTime=he(),this._lastEnsureEqual=0,this.uncached=!1,this.refCount$=new mo(null),this._result=null,this._latestChangeEvent=-1,this._ensureEqualQueue=ge,this.op=o,this.mangoQuery=r,this.collection=n,this.other=s,r||(this.mangoQuery=Ot()),this.isFindOneByIdQuery=Ca(this.collection.schema.primaryPath,r)}var t=e.prototype;return t._setResultData=function(r){if(typeof r>"u")throw _("QU18",{database:this.collection.database.name,collection:this.collection.name});if(typeof r=="number"){this._result=new no(this,[],r);return}else r instanceof Map&&(r=Array.from(r.values()));var n=new no(this,r,r.length);this._result=n},t._execOverDatabase=function(){return $(this,null,function*(){if(this._execOverDatabaseCount=this._execOverDatabaseCount+1,this.op==="count"){var r=this.getPreparedQuery(),n=yield this.collection.storageInstance.count(r);if(n.mode==="slow"&&!this.collection.database.allowSlowCount)throw _("QU14",{collection:this.collection,queryObj:this.mangoQuery});return n.count}if(this.op==="findByIds"){var s=N(this.mangoQuery.selector)[this.collection.schema.primaryPath].$in,i=new Map,a=[];if(s.forEach(c=>{var l=this.collection._docCache.getLatestDocumentDataIfExists(c);if(l){if(!l._deleted){var g=this.collection._docCache.getCachedRxDocument(l);i.set(c,g)}}else a.push(c)}),a.length>0){var u=yield this.collection.storageInstance.findDocumentsById(a,!1);u.forEach(c=>{var l=this.collection._docCache.getCachedRxDocument(c);i.set(l.primary,l)})}return i}var m=Na(this);return m.then(c=>c)})},t.exec=function(r){return $(this,null,function*(){if(r&&this.op!=="findOne")throw _("QU9",{collection:this.collection.name,query:this.mangoQuery,op:this.op});yield Os(this);var n=N(this._result);return n.getValue(r)})},t.toString=function(){var r=yo({op:this.op,query:Ie(this.collection.schema.jsonSchema,this.mangoQuery),other:this.other},!0),n=JSON.stringify(r);return this.toString=()=>n,n},t.getPreparedQuery=function(){var r={rxQuery:this,mangoQuery:Ie(this.collection.schema.jsonSchema,this.mangoQuery)};r.mangoQuery.selector._deleted={$eq:!1},r.mangoQuery.index&&r.mangoQuery.index.unshift("_deleted"),V("prePrepareQuery",r);var n=Xe(this.collection.schema.jsonSchema,r.mangoQuery);return this.getPreparedQuery=()=>n,n},t.doesDocumentDataMatch=function(r){return r._deleted?!1:this.queryMatcher(r)},t.remove=function(){return $(this,null,function*(){var r=yield this.exec();if(Array.isArray(r)){var n=yield this.collection.bulkRemove(r);if(n.error.length>0)throw kt(n.error[0]);return n.success}else return r.remove()})},t.incrementalRemove=function(){return Ge(this.asRxQuery,r=>r.incrementalRemove())},t.update=function(r){throw I("update")},t.patch=function(r){return Ge(this.asRxQuery,n=>n.patch(r))},t.incrementalPatch=function(r){return Ge(this.asRxQuery,n=>n.incrementalPatch(r))},t.modify=function(r){return Ge(this.asRxQuery,n=>n.modify(r))},t.incrementalModify=function(r){return Ge(this.asRxQuery,n=>n.incrementalModify(r))},t.where=function(r){throw I("query-builder")},t.sort=function(r){throw I("query-builder")},t.skip=function(r){throw I("query-builder")},t.limit=function(r){throw I("query-builder")},ue(e,[{key:"$",get:function(){if(!this._$){var o=this.collection.eventBulks$.pipe(K(r=>!r.isLocal),Mt(null),Ve(()=>Os(this)),ae(()=>this._result),Ct(Pt),ot((r,n)=>!!(r&&r.time===N(n).time)),K(r=>!!r),ae(r=>N(r).getValue()));this._$=fo(o,this.refCount$.pipe(K(()=>!1)))}return this._$}},{key:"$$",get:function(){var o=this.collection.database.getReactivityFactory();return o.fromObservable(this.$,void 0,this.collection.database)}},{key:"queryMatcher",get:function(){var o=this.collection.schema.jsonSchema,r=Ie(this.collection.schema.jsonSchema,this.mangoQuery);return re(this,"queryMatcher",ar(o,r))}},{key:"asRxQuery",get:function(){return this}}])}();function Ot(){return{selector:{}}}function Da(e){return e.collection._queryCache.getByQuery(e)}function et(e,t,o,r){V("preCreateRxQuery",{op:e,queryObj:t,collection:o,other:r});var n=new Sa(e,t,o,r);return n=Da(n),_s(o),n}function Ss(e){var t=e.asRxQuery.collection._changeEventBuffer.getCounter();return e._latestChangeEvent>=t}function Os(e){return $(this,null,function*(){return e.collection.awaitBeforeReads.size>0&&(yield Promise.all(Array.from(e.collection.awaitBeforeReads).map(t=>t()))),e.collection.database.closed||Ss(e)?!1:(e._ensureEqualQueue=e._ensureEqualQueue.then(()=>Ra(e)),e._ensureEqualQueue)})}function Ra(e){if(e._lastEnsureEqual=he(),e.collection.database.closed||Ss(e))return ge;var t=!1,o=!1;if(e._latestChangeEvent===-1&&(o=!0),!o){var r=e.asRxQuery.collection._changeEventBuffer.getFrom(e._latestChangeEvent+1);if(r===null)o=!0;else{e._latestChangeEvent=e.asRxQuery.collection._changeEventBuffer.getCounter();var n=e.asRxQuery.collection._changeEventBuffer.reduceByLastOfDoc(r);if(e.op==="count"){var s=N(e._result).count,i=s;n.forEach(u=>{var m=u.previousDocumentData&&e.doesDocumentDataMatch(u.previousDocumentData),c=e.doesDocumentDataMatch(u.documentData);!m&&c&&i++,m&&!c&&i--}),i!==s&&(t=!0,e._setResultData(i))}else{var a=xs(e,n);a.runFullQueryAgain?o=!0:a.changed&&(t=!0,e._setResultData(a.newResults))}}}return o?e._execOverDatabase().then(u=>(e._latestChangeEvent=e.collection._changeEventBuffer.getCounter(),typeof u=="number"?((!e._result||u!==e._result.count)&&(t=!0,e._setResultData(u)),t):((!e._result||!$o(e.collection.schema.primaryPath,u,e._result.docsData))&&(t=!0,e._setResultData(u)),t))):Promise.resolve(t)}function Na(e){return $(this,null,function*(){var t=[],o=e.collection;if(e.isFindOneByIdQuery)if(Array.isArray(e.isFindOneByIdQuery)){var r=e.isFindOneByIdQuery;if(r=r.filter(c=>{var l=e.collection._docCache.getLatestDocumentDataIfExists(c);return l?(l._deleted||t.push(l),!1):!0}),r.length>0){var n=yield o.storageInstance.findDocumentsById(r,!1);De(t,n)}}else{var s=e.isFindOneByIdQuery,i=e.collection._docCache.getLatestDocumentDataIfExists(s);if(!i){var a=yield o.storageInstance.findDocumentsById([s],!1);a[0]&&(i=a[0])}i&&!i._deleted&&t.push(i)}else{var u=e.getPreparedQuery(),m=yield o.storageInstance.query(u);t=m.documents}return t})}function Ca(e,t){if(!t.skip&&t.selector&&Object.keys(t.selector).length===1&&t.selector[e]){var o=t.selector[e];if(typeof o=="string")return o;if(Object.keys(o).length===1&&typeof o.$eq=="string"||Object.keys(o).length===1&&Array.isArray(o.$eq)&&!o.$eq.find(r=>typeof r!="string"))return o.$eq}return!1}var Ma=function(){function e(o){this.subs=[],this.counter=0,this.eventCounterMap=new WeakMap,this.buffer=[],this.limit=100,this.tasks=new Set,this.collection=o,this.subs.push(this.collection.eventBulks$.pipe(K(r=>!r.isLocal)).subscribe(r=>{this.tasks.add(()=>this._handleChangeEvents(r.events)),this.tasks.size<=1&&st().then(()=>{this.processTasks()})}))}var t=e.prototype;return t.processTasks=function(){if(this.tasks.size!==0){var r=Array.from(this.tasks);r.forEach(n=>n()),this.tasks.clear()}},t._handleChangeEvents=function(r){var n=this.counter;this.counter=this.counter+r.length,r.length>this.limit?this.buffer=r.slice(r.length*-1):(De(this.buffer,r),this.buffer=this.buffer.slice(this.limit*-1));for(var s=n+1,i=this.eventCounterMap,a=0;a<r.length;a++){var u=r[a];i.set(u,s+a)}},t.getCounter=function(){return this.processTasks(),this.counter},t.getBuffer=function(){return this.processTasks(),this.buffer},t.getArrayIndexByPointer=function(r){this.processTasks();var n=this.buffer[0],s=this.eventCounterMap.get(n);if(r<s)return null;var i=r-s;return i},t.getFrom=function(r){this.processTasks();var n=[],s=this.getArrayIndexByPointer(r);if(s===null)return null;for(;;){var i=this.buffer[s];if(s++,i)n.push(i);else return n}},t.runFrom=function(r,n){this.processTasks();var s=this.getFrom(r);if(s===null)throw new Error("out of bounds");s.forEach(i=>n(i))},t.reduceByLastOfDoc=function(r){return this.processTasks(),r.slice(0)},t.close=function(){this.tasks.clear(),this.subs.forEach(r=>r.unsubscribe())},e}();function Ds(e){return new Ma(e)}var Ia=new WeakMap;function ka(e){var t=e.schema.getDocumentPrototype(),o=Aa(e),r=Kr,n={};return[t,o,r].forEach(s=>{var i=Object.getOwnPropertyNames(s);i.forEach(a=>{var u=Object.getOwnPropertyDescriptor(s,a),m=!0;(a.startsWith("_")||a.endsWith("_")||a.startsWith("$")||a.endsWith("$"))&&(m=!1),typeof u.value=="function"?Object.defineProperty(n,a,{get(){return u.value.bind(this)},enumerable:m,configurable:!1}):(u.enumerable=m,u.configurable=!1,u.writable&&(u.writable=!1),Object.defineProperty(n,a,u))})}),n}function Rs(e){return Y(Ia,e,()=>Cn(ka(e)))}function Ns(e,t,o){var r=Mn(t,e,P.deepFreezeWhenDevMode(o));return e._runHooksSync("post","create",o,r),V("postCreateRxDocument",r),r}function Aa(e){var t={};return Object.entries(e.methods).forEach(([o,r])=>{t[o]=r}),t}var so={isEqual(e,t,o){e=Cs(e),t=Cs(t);var r=ze($e(e),$e(t));return r},resolve(e){return e.realMasterState}};function Cs(e){return e._attachments||(e=q(e),e._attachments={}),e}var Is=["pre","post"],ks=["insert","save","remove","create"],Ms=!1,tt=new Set,Ta=function(){function e(o,r,n,s,i={},a={},u={},m={},c={},l=oo,g={},p=so){this.storageInstance={},this.timeouts=new Set,this.incrementalWriteQueue={},this.awaitBeforeReads=new Set,this._incrementalUpsertQueues=new Map,this.synced=!1,this.hooks={},this._subs=[],this._docCache={},this._queryCache=$s(),this.$={},this.checkpoint$={},this._changeEventBuffer={},this.eventBulks$={},this.onClose=[],this.closed=!1,this.onRemove=[],this.database=o,this.name=r,this.schema=n,this.internalStorageInstance=s,this.instanceCreationOptions=i,this.migrationStrategies=a,this.methods=u,this.attachments=m,this.options=c,this.cacheReplacementPolicy=l,this.statics=g,this.conflictHandler=p,Pa(this.asRxCollection),o&&(this.eventBulks$=o.eventBulks$.pipe(K(h=>h.collectionName===this.name))),this.database&&tt.add(this)}var t=e.prototype;return t.prepare=function(){return $(this,null,function*(){if(!(yield Mo())){for(var r=0;r<10&&tt.size>Sr;)r++,yield this.promiseWait(30);if(tt.size>Sr)throw _("COL23",{database:this.database.name,collection:this.name,args:{existing:Array.from(tt.values()).map(u=>({db:u.database?u.database.name:"",c:u.name}))}})}this.storageInstance=cr(this.database,this.internalStorageInstance,this.schema.jsonSchema),this.incrementalWriteQueue=new Nn(this.storageInstance,this.schema.primaryPath,(u,m)=>Qr(this,u,m),u=>this._runHooks("post","save",u)),this.$=this.eventBulks$.pipe(Ve(u=>ur(u))),this.checkpoint$=this.eventBulks$.pipe(ae(u=>u.checkpoint)),this._changeEventBuffer=Ds(this.asRxCollection);var n;this._docCache=new bs(this.schema.primaryPath,this.eventBulks$.pipe(K(u=>!u.isLocal),ae(u=>u.events)),u=>(n||(n=Rs(this.asRxCollection)),Ns(this.asRxCollection,n,u)));var s=this.database.internalStore.changeStream().pipe(K(u=>{var m=this.name+"-"+this.schema.version,c=u.events.find(l=>l.documentData.context==="collection"&&l.documentData.key===m&&l.operation==="DELETE");return!!c})).subscribe(()=>$(this,null,function*(){yield this.close(),yield Promise.all(this.onRemove.map(u=>u()))}));this._subs.push(s);var i=yield this.database.storageToken,a=this.storageInstance.changeStream().subscribe(u=>{var m={id:u.id,isLocal:!1,internal:!1,collectionName:this.name,storageToken:i,events:u.events,databaseToken:this.database.token,checkpoint:u.checkpoint,context:u.context};this.database.$emit(m)});return this._subs.push(a),At})},t.cleanup=function(r){throw ie(this),I("cleanup")},t.migrationNeeded=function(){throw I("migration-schema")},t.getMigrationState=function(){throw I("migration-schema")},t.startMigration=function(r=10){return ie(this),this.getMigrationState().startMigration(r)},t.migratePromise=function(r=10){return this.getMigrationState().migratePromise(r)},t.insert=function(r){return $(this,null,function*(){ie(this);var n=yield this.bulkInsert([r]),s=n.error[0];Je(this,r[this.schema.primaryPath],r,s);var i=N(n.success[0]);return i})},t.insertIfNotExists=function(r){return $(this,null,function*(){var n=yield this.bulkInsert([r]);if(n.error.length>0){var s=n.error[0];if(s.status===409){var i=s.documentInDb;return bt(this._docCache,[i])[0]}else throw s}return n.success[0]})},t.bulkInsert=function(r){return $(this,null,function*(){if(ie(this),r.length===0)return{success:[],error:[]};var n=this.schema.primaryPath,s=new Set,i;if(this.hasHooks("pre","insert"))i=yield Promise.all(r.map(y=>{var D=Et(this.schema,y);return this._runHooks("pre","insert",D).then(()=>(s.add(D[n]),{document:D}))}));else{i=new Array(r.length);for(var a=this.schema,u=0;u<r.length;u++){var m=r[u],c=Et(a,m);s.add(c[n]),i[u]={document:c}}}if(s.size!==r.length)throw _("COL22",{collection:this.name,args:{documents:r}});var l=yield this.storageInstance.bulkWrite(i,"rx-collection-bulk-insert"),g,p=this,h={get success(){if(!g){var y=fe(p.schema.primaryPath,i,l);g=bt(p._docCache,y)}return g},error:l.error};if(this.hasHooks("post","insert")){var w=new Map;i.forEach(y=>{var D=y.document;w.set(D[n],D)}),yield Promise.all(h.success.map(y=>this._runHooks("post","insert",w.get(y.primary),y)))}return h})},t.bulkRemove=function(r){return $(this,null,function*(){ie(this);var n=this.schema.primaryPath;if(r.length===0)return{success:[],error:[]};var s;typeof r[0]=="string"?s=yield this.findByIds(r).exec():(s=new Map,r.forEach(p=>s.set(p.primary,p)));var i=[],a=new Map;Array.from(s.values()).forEach(p=>{var h=p.toMutableJSON(!0);i.push(h),a.set(p.primary,h)}),yield Promise.all(i.map(p=>{var h=p[this.schema.primaryPath];return this._runHooks("pre","remove",p,s.get(h))}));var u=i.map(p=>{var h=q(p);return h._deleted=!0,{previous:p,document:h}}),m=yield this.storageInstance.bulkWrite(u,"rx-collection-bulk-remove"),c=fe(this.schema.primaryPath,u,m),l=[],g=c.map(p=>{var h=p[n],w=this._docCache.getCachedRxDocument(p);return l.push(w),h});return yield Promise.all(g.map(p=>this._runHooks("post","remove",a.get(p),s.get(p)))),{success:l,error:m.error}})},t.bulkUpsert=function(r){return $(this,null,function*(){ie(this);var n=[],s=new Map;r.forEach(m=>{var c=Et(this.schema,m),l=c[this.schema.primaryPath];if(!l)throw _("COL3",{primaryPath:this.schema.primaryPath,data:c,schema:this.schema.jsonSchema});s.set(l,c),n.push(c)});var i=yield this.bulkInsert(n),a=i.success.slice(0),u=[];return yield Promise.all(i.error.map(m=>$(this,null,function*(){if(m.status!==409)u.push(m);else{var c=m.documentId,l=Fe(s,c),g=N(m.documentInDb),p=this._docCache.getCachedRxDocuments([g])[0],h=yield p.incrementalModify(()=>l);a.push(h)}}))),{error:u,success:a}})},t.upsert=function(r){return $(this,null,function*(){ie(this);var n=yield this.bulkUpsert([r]);return Je(this.asRxCollection,r[this.schema.primaryPath],r,n.error[0]),n.success[0]})},t.incrementalUpsert=function(r){ie(this);var n=Et(this.schema,r),s=n[this.schema.primaryPath];if(!s)throw _("COL4",{data:r});var i=this._incrementalUpsertQueues.get(s);return i||(i=At),i=i.then(()=>La(this,s,n)).then(a=>a.inserted?a.doc:Fa(a.doc,n)),this._incrementalUpsertQueues.set(s,i),i},t.find=function(r){ie(this),V("prePrepareRxQuery",{op:"find",queryObj:r,collection:this}),r||(r=Ot());var n=et("find",r,this);return n},t.findOne=function(r){ie(this),V("prePrepareRxQuery",{op:"findOne",queryObj:r,collection:this});var n;if(typeof r=="string")n=et("findOne",{selector:{[this.schema.primaryPath]:r},limit:1},this);else{if(r||(r=Ot()),r.limit)throw _("QU6");r=q(r),r.limit=1,n=et("findOne",r,this)}return n},t.count=function(r){ie(this),r||(r=Ot());var n=et("count",r,this);return n},t.findByIds=function(r){ie(this);var n={selector:{[this.schema.primaryPath]:{$in:r.slice(0)}}},s=et("findByIds",n,this);return s},t.exportJSON=function(){throw I("json-dump")},t.importJSON=function(r){throw I("json-dump")},t.insertCRDT=function(r){throw I("crdt")},t.addPipeline=function(r){throw I("pipeline")},t.addHook=function(r,n,s,i=!1){if(typeof s!="function")throw _r("COL7",{key:n,when:r});if(!Is.includes(r))throw _r("COL8",{key:n,when:r});if(!ks.includes(n))throw _("COL9",{key:n});if(r==="post"&&n==="create"&&i===!0)throw _("COL10",{when:r,key:n,parallel:i});var a=s.bind(this),u=i?"parallel":"series";this.hooks[n]=this.hooks[n]||{},this.hooks[n][r]=this.hooks[n][r]||{series:[],parallel:[]},this.hooks[n][r][u].push(a)},t.getHooks=function(r,n){return!this.hooks[n]||!this.hooks[n][r]?{series:[],parallel:[]}:this.hooks[n][r]},t.hasHooks=function(r,n){if(!this.hooks[n]||!this.hooks[n][r])return!1;var s=this.getHooks(r,n);return s?s.series.length>0||s.parallel.length>0:!1},t._runHooks=function(r,n,s,i){var a=this.getHooks(r,n);if(!a)return At;var u=a.series.map(m=>()=>m(s,i));return Oo(u).then(()=>Promise.all(a.parallel.map(m=>m(s,i))))},t._runHooksSync=function(r,n,s,i){if(this.hasHooks(r,n)){var a=this.getHooks(r,n);a&&a.series.forEach(u=>u(s,i))}},t.promiseWait=function(r){var n=new Promise(s=>{var i=setTimeout(()=>{this.timeouts.delete(i),s()},r);this.timeouts.add(i)});return n},t.close=function(){return $(this,null,function*(){return this.closed?ge:(tt.delete(this),yield Promise.all(this.onClose.map(r=>r())),this.closed=!0,Array.from(this.timeouts).forEach(r=>clearTimeout(r)),this._changeEventBuffer&&this._changeEventBuffer.close(),this.database.requestIdlePromise().then(()=>this.storageInstance.close()).then(()=>(this._subs.forEach(r=>r.unsubscribe()),delete this.database.collections[this.name],Re("postCloseRxCollection",this).then(()=>!0))))})},t.remove=function(){return $(this,null,function*(){yield this.close(),yield Promise.all(this.onRemove.map(r=>r())),yield fr(this.database.storage,this.database.internalStore,this.database.token,this.database.name,this.name,this.database.multiInstance,this.database.password,this.database.hashFunction)})},ue(e,[{key:"insert$",get:function(){return this.$.pipe(K(o=>o.operation==="INSERT"))}},{key:"update$",get:function(){return this.$.pipe(K(o=>o.operation==="UPDATE"))}},{key:"remove$",get:function(){return this.$.pipe(K(o=>o.operation==="DELETE"))}},{key:"asRxCollection",get:function(){return this}}])}();function Pa(e){if(!Ms){Ms=!0;var t=Object.getPrototypeOf(e);ks.forEach(o=>{Is.map(r=>{var n=r+Tt(o);t[n]=function(s,i){return this.addHook(r,o,s,i)}})})}}function Fa(e,t){return e.incrementalModify(o=>t)}function La(e,t,o){var r=e._docCache.getLatestDocumentDataIfExists(t);return r?Promise.resolve({doc:e._docCache.getCachedRxDocuments([r])[0],inserted:!1}):e.findOne(t).exec().then(n=>n?{doc:n,inserted:!1}:e.insert(o).then(s=>({doc:s,inserted:!0})))}function As(p){return $(this,arguments,function*({database:e,name:t,schema:o,instanceCreationOptions:r={},migrationStrategies:n={},autoMigrate:s=!0,statics:i={},methods:a={},attachments:u={},options:m={},localDocuments:c=!1,cacheReplacementPolicy:l=oo,conflictHandler:g=so}){var h={databaseInstanceToken:e.token,databaseName:e.name,collectionName:t,schema:o.jsonSchema,options:r,multiInstance:e.multiInstance,password:e.password,devMode:P.isDevMode()};V("preCreateRxStorageInstance",h);var w=yield Tn(e,h),y=new Ta(e,t,o,w,r,n,a,u,m,l,i,g);try{yield y.prepare(),Object.entries(i).forEach(([D,E])=>{Object.defineProperty(y,D,{get:()=>E.bind(y)})}),V("createRxCollection",{collection:y,creator:{name:t,schema:o,storageInstance:w,instanceCreationOptions:r,migrationStrategies:n,methods:a,attachments:u,options:m,cacheReplacementPolicy:l,localDocuments:c,statics:i}}),s&&y.schema.version!==0&&(yield y.migratePromise())}catch(D){throw tt.delete(y),yield w.close(),D}return y})}var uo=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;this._parallels=t||1,this._qC=0,this._iC=new Set,this._lHN=0,this._hPM=new Map,this._pHM=new Map};uo.prototype={isIdle:function(){return this._qC<this._parallels},lock:function(){this._qC++},unlock:function(){this._qC--,ao(this)},wrapCall:function(t){var o=this;this._qC++;var r;try{r=t()}catch(n){throw this.unlock(),n}return!r.then||typeof r.then!="function"?(this.unlock(),r):r.then(function(n){return o.unlock(),n}).catch(function(n){throw o.unlock(),n})},requestIdlePromise:function(t){var o=this;t=t||{};var r,n=new Promise(function(a){return r=a}),s=function(){io(o,n),r()};if(n._manRes=s,t.timeout){var i=setTimeout(function(){n._manRes()},t.timeout);n._timeoutObj=i}return this._iC.add(n),ao(this),n},cancelIdlePromise:function(t){io(this,t)},requestIdleCallback:function(t,o){var r=this._lHN++,n=this.requestIdlePromise(o);return this._hPM.set(r,n),this._pHM.set(n,r),n.then(function(){return t()}),r},cancelIdleCallback:function(t){var o=this._hPM.get(t);this.cancelIdlePromise(o)},clear:function(){var t=this;this._iC.forEach(function(o){return io(t,o)}),this._qC=0,this._iC.clear(),this._hPM=new Map,this._pHM=new Map}};function Ba(e){if(e._iC.size!==0){var t=e._iC.values(),o=t.next().value;o._manRes(),setTimeout(function(){return ao(e)},0)}}function io(e,t){if(t){if(t._timeoutObj&&clearTimeout(t._timeoutObj),e._pHM.has(t)){var o=e._pHM.get(t);e._hPM.delete(o),e._pHM.delete(t)}e._iC.delete(t)}}function ao(e){e._tryIR||e._iC.size===0||(e._tryIR=!0,setTimeout(function(){if(!e.isIdle()){e._tryIR=!1;return}setTimeout(function(){if(!e.isIdle()){e._tryIR=!1;return}Ba(e),e._tryIR=!1},0)},0))}var xr=class{ttl;map=new Map;_to=!1;constructor(t){this.ttl=t}has(t){return this.map.has(t)}add(t){this.map.set(t,Ts()),this._to||(this._to=!0,setTimeout(()=>{this._to=!1,Ua(this)},0))}clear(){this.map.clear()}};function Ua(e){let t=Ts()-e.ttl,o=e.map[Symbol.iterator]();for(;;){let r=o.next().value;if(!r)return;let n=r[0];if(r[1]<t)e.map.delete(n);else return}}function Ts(){return Date.now()}var co=new Set,Ps=new Map,Fs=0,Va=function(){function e(o,r,n,s,i,a,u=!1,m={},c,l,g,p,h,w){this.idleQueue=new uo,this.rxdbVersion=br,this.storageInstances=new Set,this._subs=[],this.startupErrors=[],this.onClose=[],this.closed=!1,this.collections={},this.states={},this.eventBulks$=new lo,this.closePromise=null,this.observable$=this.eventBulks$.pipe(Ve(y=>ur(y))),this.storageToken=ge,this.storageTokenDocument=ge,this.emittedEventBulkIds=new xr(60*1e3),this.name=o,this.token=r,this.storage=n,this.instanceCreationOptions=s,this.password=i,this.multiInstance=a,this.eventReduce=u,this.options=m,this.internalStore=c,this.hashFunction=l,this.cleanupPolicy=g,this.allowSlowCount=p,this.reactivity=h,this.onClosed=w,Fs++,this.name!=="pseudoInstance"&&(this.internalStore=cr(this.asRxDatabase,c,lr),this.storageTokenDocument=An(this.asRxDatabase).catch(y=>this.startupErrors.push(y)),this.storageToken=this.storageTokenDocument.then(y=>y.data.token).catch(y=>this.startupErrors.push(y)))}var t=e.prototype;return t.getReactivityFactory=function(){if(!this.reactivity)throw _("DB14",{database:this.name});return this.reactivity},t.$emit=function(r){this.emittedEventBulkIds.has(r.id)||(this.emittedEventBulkIds.add(r.id),this.eventBulks$.next(r))},t.removeCollectionDoc=function(r,n){return $(this,null,function*(){var s=yield wt(this.internalStore,Ze(_t(r,n),ke));if(!s)throw _("SNH",{name:r,schema:n});var i=$t(s);i._deleted=!0,yield this.internalStore.bulkWrite([{document:i,previous:s}],"rx-database-remove-collection")})},t.addCollections=function(r){return $(this,null,function*(){var n={},s={},i=[],a={};yield Promise.all(Object.entries(r).map(g=>$(this,[g],function*([c,l]){var p=c,h=l.schema;n[p]=h;var w=Io(h,this.hashFunction);if(s[p]=w,this.collections[c])throw _("DB3",{name:c});var y=_t(c,h),D={id:Ze(y,ke),key:y,context:ke,data:{name:p,schemaHash:yield w.hash,schema:w.jsonSchema,version:w.version,connectedStorages:[]},_deleted:!1,_meta:je(),_rev:We(),_attachments:{}};i.push({document:D});var E=Object.assign({},l,{name:p,schema:w,database:this}),O=q(l);O.database=this,O.name=c,V("preCreateRxCollection",O),E.conflictHandler=O.conflictHandler,a[p]=E})));var u=yield this.internalStore.bulkWrite(i,"rx-database-add-collection");yield qa(this),yield Promise.all(u.error.map(c=>$(this,null,function*(){if(c.status!==409)throw _("DB12",{database:this.name,writeError:c});var l=N(c.documentInDb),g=l.data.name,p=s[g];if(l.data.schemaHash!==(yield p.hash))throw _("DB6",{database:this.name,collection:g,previousSchemaHash:l.data.schemaHash,schemaHash:yield p.hash,previousSchema:l.data.schema,schema:N(n[g])})})));var m={};return yield Promise.all(Object.keys(r).map(c=>$(this,null,function*(){var l=a[c],g=yield As(l);m[c]=g,this.collections[c]=g,this[c]||Object.defineProperty(this,c,{get:()=>this.collections[c]})}))),m})},t.lockedRun=function(r){return this.idleQueue.wrapCall(r)},t.requestIdlePromise=function(){return this.idleQueue.requestIdlePromise()},t.exportJSON=function(r){throw I("json-dump")},t.addState=function(r){throw I("state")},t.importJSON=function(r){throw I("json-dump")},t.backup=function(r){throw I("backup")},t.leaderElector=function(){throw I("leader-election")},t.isLeader=function(){throw I("leader-election")},t.waitForLeadership=function(){throw I("leader-election")},t.migrationStates=function(){throw I("migration-schema")},t.close=function(){if(this.closePromise)return this.closePromise;var{promise:r,resolve:n}=Ls(),s=i=>{this.onClosed&&this.onClosed(),this.closed=!0,n(i)};return this.closePromise=r,$(this,null,function*(){if(yield Re("preCloseRxDatabase",this),this.eventBulks$.complete(),Fs--,this._subs.map(i=>i.unsubscribe()),this.name==="pseudoInstance"){s(!1);return}return this.requestIdlePromise().then(()=>Promise.all(this.onClose.map(i=>i()))).then(()=>Promise.all(Object.keys(this.collections).map(i=>this.collections[i]).map(i=>i.close()))).then(()=>this.internalStore.close()).then(()=>s(!0))}),r},t.remove=function(){return this.close().then(()=>Wa(this.name,this.storage,this.multiInstance,this.password))},ue(e,[{key:"$",get:function(){return this.observable$}},{key:"asRxDatabase",get:function(){return this}}])}();function ja(e,t){if(co.has(Bs(e,t)))throw _("DB8",{name:e,storage:t.name,link:"https://rxdb.info/rx-database.html#ignoreduplicate"})}function Ls(){var e,t,o=new Promise((r,n)=>{e=r,t=n});return{promise:o,resolve:e,reject:t}}function Bs(e,t){return t.name+"|"+e}function Us(e,t,o,r,n,s){return $(this,null,function*(){var i=yield t.createStorageInstance({databaseInstanceToken:e,databaseName:o,collectionName:Dn,schema:lr,options:r,multiInstance:n,password:s,devMode:P.isDevMode()});return i})}function fR({storage:e,instanceCreationOptions:t,name:o,password:r,multiInstance:n=!0,eventReduce:s=!0,ignoreDuplicate:i=!1,options:a={},cleanupPolicy:u,closeDuplicates:m=!1,allowSlowCount:c=!1,localDocuments:l=!1,hashFunction:g=Ut,reactivity:p}){V("preCreateRxDatabase",{storage:e,instanceCreationOptions:t,name:o,password:r,multiInstance:n,eventReduce:s,ignoreDuplicate:i,options:a,localDocuments:l});var h=Bs(o,e),w=Ps.get(h)||new Set,y=Ls(),D=Array.from(w),E=()=>{w.delete(y.promise),co.delete(h)};return w.add(y.promise),Ps.set(h,w),$(null,null,function*(){if(m&&(yield Promise.all(D.map(U=>U.catch(()=>null).then(S=>S&&S.close())))),i){if(!P.isDevMode())throw _("DB9",{database:o})}else ja(o,e);co.add(h);var O=Pe(10),j=yield Us(O,e,o,t,n,r),A=new Va(o,O,e,t,r,n,s,a,j,g,u,c,p,E);return yield Re("createRxDatabase",{database:A,creator:{storage:e,instanceCreationOptions:t,name:o,password:r,multiInstance:n,eventReduce:s,ignoreDuplicate:i,options:a,localDocuments:l}}),A}).then(O=>{y.resolve(O)}).catch(O=>{y.reject(O),E()}),y.promise}function Wa(e,t,o=!0,r){return $(this,null,function*(){var n=Pe(10),s=yield Us(n,t,e,{},o,r),i=yield mr(s),a=new Set;i.forEach(m=>a.add(m.data.name));var u=Array.from(a);return yield Promise.all(u.map(m=>fr(t,s,n,e,m,o,r))),yield Re("postRemoveRxDatabase",{databaseName:e,storage:t}),yield s.remove(),u})}function qa(e){return $(this,null,function*(){if(yield e.storageToken,e.startupErrors[0])throw e.startupErrors[0]})}export{Be as a,at as b,Ut as c,Ha as d,ze as e,su as f,he as g,br as h,Sr as i,Mo as j,Rr as k,V as l,Re as m,Gs as n,gu as o,ut as p,ct as q,bn as r,ar as s,Xe as t,CO as u,MO as v,$e as w,$t as x,IO as y,Ji as z,kO as A,fe as B,Kr as C,Cn as D,Sa as E,oS as F,nS as G,Ta as H,xr as I,Va as J,fR as K};
