{"version":3,"file":"default-conflict-handler.js","names":["_index","require","_rxStorageHelper","defaultConflictHandler","exports","isEqual","a","b","_ctx","addAttachmentsIfNotExists","ret","deepEqual","stripAttachmentsDataFromDocument","resolve","i","realMasterState","d","_attachments","flatClone"],"sources":["../../../src/replication-protocol/default-conflict-handler.ts"],"sourcesContent":["import {\n    deepEqual,\n    flatClone\n} from '../plugins/utils/index.ts';\nimport { stripAttachmentsDataFromDocument } from '../rx-storage-helper.ts';\nimport type { RxConflictHandler, RxDocumentData } from '../types';\n\nexport const defaultConflictHandler: RxConflictHandler<any> = {\n    isEqual(a, b, _ctx) {\n        a = addAttachmentsIfNotExists(a);\n        b = addAttachmentsIfNotExists(b);\n\n        /**\n         * If the documents are deep equal,\n         * we have no conflict.\n         * On your custom conflict handler you might only\n         * check some properties, like the updatedAt time,\n         * for better performance, because deepEqual is expensive.\n        */\n        const ret = deepEqual(\n            stripAttachmentsDataFromDocument(a),\n            stripAttachmentsDataFromDocument(b)\n        );\n\n        return ret;\n    },\n    resolve(i) {\n        /**\n         * The default conflict handler will always\n         * drop the fork state and use the master state instead.\n         */\n        return i.realMasterState;\n    }\n};\n\n\nfunction addAttachmentsIfNotExists<T>(d: RxDocumentData<T>): RxDocumentData<T> {\n    if (!d._attachments) {\n        d = flatClone(d);\n        d._attachments = {};\n    }\n    return d;\n}\n"],"mappings":";;;;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AAIA,IAAAC,gBAAA,GAAAD,OAAA;AAGO,IAAME,sBAA8C,GAAAC,OAAA,CAAAD,sBAAA,GAAG;EAC1DE,OAAOA,CAACC,CAAC,EAAEC,CAAC,EAAEC,IAAI,EAAE;IAChBF,CAAC,GAAGG,yBAAyB,CAACH,CAAC,CAAC;IAChCC,CAAC,GAAGE,yBAAyB,CAACF,CAAC,CAAC;;IAEhC;AACR;AACA;AACA;AACA;AACA;AACA;IACQ,IAAMG,GAAG,GAAG,IAAAC,gBAAS,EACjB,IAAAC,iDAAgC,EAACN,CAAC,CAAC,EACnC,IAAAM,iDAAgC,EAACL,CAAC,CACtC,CAAC;IAED,OAAOG,GAAG;EACd,CAAC;EACDG,OAAOA,CAACC,CAAC,EAAE;IACP;AACR;AACA;AACA;IACQ,OAAOA,CAAC,CAACC,eAAe;EAC5B;AACJ,CAAC;AAGD,SAASN,yBAAyBA,CAAIO,CAAoB,EAAqB;EAC3E,IAAI,CAACA,CAAC,CAACC,YAAY,EAAE;IACjBD,CAAC,GAAG,IAAAE,gBAAS,EAACF,CAAC,CAAC;IAChBA,CAAC,CAACC,YAAY,GAAG,CAAC,CAAC;EACvB;EACA,OAAOD,CAAC;AACZ","ignoreList":[]}